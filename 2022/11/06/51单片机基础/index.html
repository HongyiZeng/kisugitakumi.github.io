<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>51单片机基础 | Kisugi Takumi</title><meta name="keywords" content="51单片机"><meta name="author" content="Kisugi Takumi,zenghongyi1@google.com"><meta name="copyright" content="Kisugi Takumi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="51单片机是对兼容英特尔8051指令系统的单片机的统称。51单片机广泛应用于家用电器、汽车、工业测控、通信设备中。因为51单片机的指令系统、内部结构相对简单，所以国内许多高校用其进行单片机入门教学。">
<meta property="og:type" content="article">
<meta property="og:title" content="51单片机基础">
<meta property="og:url" content="https://kisugitakumi.github.io/2022/11/06/51%E5%8D%95%E7%89%87%E6%9C%BA%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="Kisugi Takumi">
<meta property="og:description" content="51单片机是对兼容英特尔8051指令系统的单片机的统称。51单片机广泛应用于家用电器、汽车、工业测控、通信设备中。因为51单片机的指令系统、内部结构相对简单，所以国内许多高校用其进行单片机入门教学。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kisugitakumi.github.io/img/51danpianji.png">
<meta property="article:published_time" content="2022-11-06T06:46:25.000Z">
<meta property="article:modified_time" content="2023-01-15T11:24:12.727Z">
<meta property="article:author" content="Kisugi Takumi">
<meta property="article:tag" content="51单片机">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kisugitakumi.github.io/img/51danpianji.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://kisugitakumi.github.io/2022/11/06/51%E5%8D%95%E7%89%87%E6%9C%BA%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Kisugi Takumi","link":"链接: ","source":"来源: Kisugi Takumi","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '51单片机基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-15 19:24:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">97</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">77</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-brain"></i><span> 我的豆瓣</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fab fa-steam-square"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/create/"><i class="fa-fw fas fa-user-edit"></i><span> 我的创作</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-kiss-wink-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Kisugi Takumi</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-brain"></i><span> 我的豆瓣</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fab fa-steam-square"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/create/"><i class="fa-fw fas fa-user-edit"></i><span> 我的创作</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-kiss-wink-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">51单片机基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-06T06:46:25.000Z" title="发表于 2022-11-06 14:46:25">2022-11-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-15T11:24:12.727Z" title="更新于 2023-01-15 19:24:12">2023-01-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C%E8%AF%AD%E8%A8%80/">C语言</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">17.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>64分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="51单片机基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="51单片机基础"><a href="#51单片机基础" class="headerlink" title="51单片机基础"></a>51单片机基础</h1><p>学习时间：2022年11月6日</p>
<p>学习来源：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Mb411e7re/">江科大自化协</a></p>
<h2 id="1-开发工具"><a href="#1-开发工具" class="headerlink" title="1 开发工具"></a>1 开发工具</h2><p><code>Keil5</code>：<code>Keil C51</code>是美国<code>Keil Software</code>公司出品的51系列兼容单片机<strong>C语言软件开发系统</strong>。Keil提供了包括C编译器、宏汇编、链接器、库管理和一个功能强大的仿真调试器等在内的完整开发方案，通过一个集成开发环境（<code>μVision</code>）将这些部分组合在一起。</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.keil.com/">https://www.keil.com/</a></p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://www.keil.com/download/product/">https://www.keil.com/download/product/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img18/image-20221106083912547.png" alt="image-20221106083912547"></p>
<p>STC-ISP：STC-ISP 是一款单片机下载编程烧录软件，是针对STC系列单片机而设计的，可下载STC89系列、12C2052系列和12C5410等系列的STC单片机，使用简便。</p>
<p>官网：<a target="_blank" rel="noopener" href="http://www.stcmcudata.com/">http://www.stcmcudata.com/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img18/image-20221106085143818.png" alt="image-20221106085143818"></p>
<h2 id="2-单片机和开发板介绍"><a href="#2-单片机和开发板介绍" class="headerlink" title="2 单片机和开发板介绍"></a>2 单片机和开发板介绍</h2><h3 id="2-1-单片机"><a href="#2-1-单片机" class="headerlink" title="2.1 单片机"></a>2.1 单片机</h3><p>单片机（Single-Chip Microcomputer）是一种集成电路芯片，是采用超大规模集成电路技术把具有数据处理能力的中央处理器CPU、随机存储器RAM、只读存储器ROM、多种I/O口和中断系统、定时器/计数器等功能（可能还包括显示驱动电路、脉宽调制电路、模拟多路转换器、A/D转换器等电路）集成到一块硅片上构成的一个小而完善的<strong>微型计算机系统</strong>，在工业控制领域广泛应用。</p>
<p>从上世纪80年代，由当时的4位、8位单片机，发展到现在的300M的高速单片机。</p>
<p>单片机又称单片微控制器，它不是完成某一个逻辑功能的芯片，而是把一个计算机系统集成到一个芯片上。相当于一个微型的计算机，和计算机相比，单片机只缺少了I/O设备。概括的讲：<strong>一块芯片就成了一台计算机</strong>。</p>
<h3 id="2-2-51单片机"><a href="#2-2-51单片机" class="headerlink" title="2.2 51单片机"></a>2.2 51单片机</h3><p>51单片机是对<strong>兼容英特尔8051指令系统</strong>的单片机的统称。51单片机广泛应用于家用电器、汽车、工业测控、通信设备中。</p>
<ul>
<li>主要产品：<ul>
<li><code>Intel</code>（英特尔）：80C31、80C51、87C51，80C32、80C52、87C52等；</li>
<li><code>Atmel</code>（艾特梅尔）：89C51、89C52、89C2051，89S51(RC)，89S52(RC)等；</li>
<li>Philips（飞利浦）、华邦、Dallas（达拉斯）、Siemens（西门子）等公司的许多产品；</li>
<li><code>STC</code>（宏晶）：STC89C51、STC90C51、STC11系列、STC15系列、STC8系列等。</li>
</ul>
</li>
</ul>
<blockquote>
<p>STC89C52单片机</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img18/image-20221106091048956.png" alt="image-20221106091048956"></p>
<ul>
<li>所属系列：51单片机系列</li>
<li>公司：STC公司（宏晶），中国公司</li>
<li>位数：8位</li>
<li>RAM：512字节</li>
<li>ROM：8K（Flash）</li>
<li>工作频率：12MHz（本开发板使用）</li>
</ul>
<blockquote>
<p>命名规则</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img18/image-20221106091344914.png" alt="image-20221106091344914"></p>
<blockquote>
<p>内部结构</p>
</blockquote>
<p>STC89C52系列单片机的内部结构框图如下图所示。STC89C52单片机中包含中央处理器（CPU）、程序存储器（Flash）、数据存储器（SRAM）、定时/计数器、UJART串口、I/O接口、EE-PROM、看门狗等模块。STC89C52系列单片机几平包含了数据采集和控制中所需的所有单元模块，可称得上一个片上系统。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img18/image-20221106092106234.png" alt="image-20221106092106234"></p>
<h3 id="2-3-开发板"><a href="#2-3-开发板" class="headerlink" title="2.3 开发板"></a>2.3 开发板</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img18/image-20221106092617470.png" alt="image-20221106092617470"></p>
<blockquote>
<p>原理图</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img18/image-20221106093607492.png" alt="image-20221106093607492"></p>
<p>注：我的自用开发板（<code>STC89C52 RC</code>）：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221111095510049.png" alt="image-20221111095510049"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221111095532817.png" alt="image-20221111095532817"></p>
<h2 id="3-LED"><a href="#3-LED" class="headerlink" title="3 LED"></a>3 LED</h2><h3 id="3-1-点亮一个LED"><a href="#3-1-点亮一个LED" class="headerlink" title="3.1 点亮一个LED"></a>3.1 点亮一个LED</h3><h4 id="3-1-1-新建工程"><a href="#3-1-1-新建工程" class="headerlink" title="3.1.1 新建工程"></a>3.1.1 新建工程</h4><ul>
<li>在Keil5中新建一个工程：搜索<code>AT89C52</code>（采用的是Atmel），然后选择<code>否</code>，不生成启动文件。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221110151651414.png" alt="image-20221110151651414"></p>
<ul>
<li>新建C源代码文件</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221110151857736.png" alt="image-20221110151857736"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221110151917508.png" alt="image-20221110151917508"></p>
<ul>
<li>编写初始代码</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>构建<code>build</code>项目</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221110152240453.png" alt="image-20221110152240453"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221110152253228.png" alt="image-20221110152253228"></p>
<h4 id="3-1-2-LED介绍"><a href="#3-1-2-LED介绍" class="headerlink" title="3.1.2 LED介绍"></a>3.1.2 LED介绍</h4><p>发光二极管（<code>Light Emitting Diode</code>）</p>
<p>简称：LED</p>
<p>用途：照明、广告灯、指引灯、屏幕</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221110152757233.png" alt="image-20221110152757233"></p>
<p>上图：左正右负。</p>
<blockquote>
<p>原理图</p>
</blockquote>
<p>简单的原理：单片机的CPU通过向<strong>IO口</strong>写入值（1高电平5v，0低电平0v），来控制硬件电路的<strong>高低电平</strong>。</p>
<ul>
<li>LED模块</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221110154407963.png" alt="image-20221110154407963"></p>
<p>从上图可知，LED模块引出的管脚编号从P20~P27，共8个管脚，控制8个LED</p>
<ul>
<li>单片机核心</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221110154544972.png" alt="image-20221110154544972"></p>
<p>从上图可知，LED的<code>P20~P27</code>管脚连接至单片机CPU的<code>P2.0~P2.7</code>管脚。因此通过控制51单片机核心中的<strong>P2特殊功能寄存器的每一位的值</strong>，来控制输出到LED的<code>P20~P27</code>管脚的电平高低。</p>
<p>例如，如果<code>P2.0</code>的值设置为1，代表高电平，此时LED灭（两端没有电压差）；相反设置为0，代表低电平，此时LED亮。</p>
<h4 id="3-1-3-代码实现"><a href="#3-1-3-代码实现" class="headerlink" title="3.1.3 代码实现"></a>3.1.3 代码实现</h4><p>这里让P20（芯片寄存器为P2，位号为P2.0）对应的LED亮，其他LED灭。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	P2 = <span class="number">0xFE</span>; <span class="comment">// P2.7~P2.0 1111 0000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>头文件<code>REGX52.H</code>包含了<code>AT89X52</code>芯片的寄存器变量（仅列出部分）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">AT89X52.H</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Header file for the low voltage Flash Atmel AT89C52 and AT89LV52.</span></span><br><span class="line"><span class="comment">Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.</span></span><br><span class="line"><span class="comment">All rights reserved.</span></span><br><span class="line"><span class="comment">--------------------------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __AT89X52_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __AT89X52_H__</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*------------------------------------------------</span></span><br><span class="line"><span class="comment">Byte Registers</span></span><br><span class="line"><span class="comment">------------------------------------------------*/</span></span><br><span class="line">sfr P0      = <span class="number">0x80</span>;</span><br><span class="line">sfr SP      = <span class="number">0x81</span>;</span><br><span class="line">sfr DPL     = <span class="number">0x82</span>;</span><br><span class="line">sfr DPH     = <span class="number">0x83</span>;</span><br><span class="line">sfr PCON    = <span class="number">0x87</span>;</span><br><span class="line">sfr TCON    = <span class="number">0x88</span>;</span><br><span class="line">sfr TMOD    = <span class="number">0x89</span>;</span><br><span class="line">sfr TL0     = <span class="number">0x8A</span>;</span><br><span class="line">sfr TL1     = <span class="number">0x8B</span>;</span><br><span class="line">sfr TH0     = <span class="number">0x8C</span>;</span><br><span class="line">sfr TH1     = <span class="number">0x8D</span>;</span><br><span class="line">sfr P1      = <span class="number">0x90</span>;</span><br><span class="line">sfr SCON    = <span class="number">0x98</span>;</span><br><span class="line">sfr SBUF    = <span class="number">0x99</span>;</span><br><span class="line">sfr P2      = <span class="number">0xA0</span>; <span class="comment">// P2特殊功能寄存器（8位），0xA0是IO口P2在RAM中的字节地址</span></span><br><span class="line">sfr IE      = <span class="number">0xA8</span>;</span><br><span class="line">sfr P3      = <span class="number">0xB0</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>然后构建，生成相应的<code>hex</code>十六进制文件</p>
<h4 id="3-1-4-烧录"><a href="#3-1-4-烧录" class="headerlink" title="3.1.4 烧录"></a>3.1.4 烧录</h4><ul>
<li>相应设置：</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221110163657714.png" alt="image-20221110163657714"></p>
<p>打开程序文件：选择项目下构建好的<code>hex</code>十六进制文件，然后下载。</p>
<p>关闭单片机，再进行冷启动（单片机在冷启动时加载程序），之后即可发现LED亮。</p>
<blockquote>
<p>程序改进</p>
</blockquote>
<p>单片机上电后，会执行main函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	P2 = <span class="number">0xFE</span>; <span class="comment">// P2.7~P2.0 1111 0000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行到第三行后，LED亮，之后从main函数退出，cpu会再次执行main函数，到第三行，LED亮，如此反复，此时cpu会不断操作P2寄存器。</p>
<p>改进：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	P2 = <span class="number">0xFE</span>; <span class="comment">// P2.7~P2.0 1111 0000</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>cpu执行至第4行进入死循环，此时<code>P2 = 0xFE;</code>，LED一直亮，且cpu不会再操作P2寄存器。</p>
<h3 id="3-2-LED闪烁"><a href="#3-2-LED闪烁" class="headerlink" title="3.2 LED闪烁"></a>3.2 LED闪烁</h3><p>效果：让LED以1s为周期闪烁。新建一个工程。</p>
<blockquote>
<p>代码实现</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;INTRINS.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay1000ms</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i, j, k;</span><br><span class="line"></span><br><span class="line">	_nop_();</span><br><span class="line">	i = <span class="number">8</span>;</span><br><span class="line">	j = <span class="number">154</span>;</span><br><span class="line">	k = <span class="number">122</span>;</span><br><span class="line">	<span class="keyword">do</span>&#123;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (--k);</span><br><span class="line">		&#125; <span class="keyword">while</span> (--j);</span><br><span class="line">	&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">		P2 = <span class="number">0xFE</span>;</span><br><span class="line">		Delay1000ms();</span><br><span class="line">		P2 = <span class="number">0xFF</span>;</span><br><span class="line">        Delay1000ms();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-LED流水灯"><a href="#3-3-LED流水灯" class="headerlink" title="3.3 LED流水灯"></a>3.3 LED流水灯</h3><p>效果：LED逐一亮灭。</p>
<blockquote>
<p>代码实现</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;INTRINS.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay500ms</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i, j, k;</span><br><span class="line"></span><br><span class="line">	_nop_();</span><br><span class="line">	i = <span class="number">4</span>;</span><br><span class="line">	j = <span class="number">205</span>;</span><br><span class="line">	k = <span class="number">187</span>;</span><br><span class="line">	<span class="keyword">do</span>&#123;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (--k);</span><br><span class="line">		&#125; <span class="keyword">while</span> (--j);</span><br><span class="line">	&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		P2 = <span class="number">0xFE</span>; <span class="comment">// 1111 1110</span></span><br><span class="line">		Delay500ms();</span><br><span class="line">		P2 = <span class="number">0xFD</span>; <span class="comment">// 1111 1101</span></span><br><span class="line">		Delay500ms();</span><br><span class="line">		P2 = <span class="number">0xFB</span>; <span class="comment">// 1111 1011</span></span><br><span class="line">		Delay500ms();</span><br><span class="line">		P2 = <span class="number">0xF7</span>; <span class="comment">// 1111 0111</span></span><br><span class="line">		Delay500ms();</span><br><span class="line">		P2 = <span class="number">0xEF</span>; <span class="comment">// 1110 1111</span></span><br><span class="line">		Delay500ms();</span><br><span class="line">		P2 = <span class="number">0xDF</span>; <span class="comment">// 1101 1111</span></span><br><span class="line">		Delay500ms();</span><br><span class="line">		P2 = <span class="number">0xBF</span>; <span class="comment">// 1011 1111</span></span><br><span class="line">		Delay500ms();</span><br><span class="line">		P2 = <span class="number">0x7F</span>; <span class="comment">// 0111 1111</span></span><br><span class="line">		Delay500ms();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码优化：修改延时代码，接受一个参数n来控制熄灭的时间。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// n为延时的时间，单位ms</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i, j;</span><br><span class="line">	<span class="keyword">while</span>(n) &#123;</span><br><span class="line">		i = <span class="number">2</span>;</span><br><span class="line">		j = <span class="number">239</span>;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (--j);</span><br><span class="line">		&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">		n--;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-独立按键"><a href="#4-独立按键" class="headerlink" title="4 独立按键"></a>4 独立按键</h2><h3 id="4-1-介绍"><a href="#4-1-介绍" class="headerlink" title="4.1 介绍"></a>4.1 介绍</h3><p>轻触按键：相当于是一种电子开关，按下时开关接通，松开时开关断开，实现原理是通过轻触按键内部的金属弹片受力弹动来实现接通和断开。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221111095750241.png" alt="image-20221111095750241"></p>
<blockquote>
<p>电路原理图</p>
</blockquote>
<ul>
<li>独立按键模块：例如，按下K1时，P31接地为低电平（0），使得cpu的P3寄存器的该位为0；反之为1。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221111103411354.png" alt="image-20221111103411354"></p>
<ul>
<li>cpu：接至<code>P3</code>寄存器</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221111101404759.png" alt="image-20221111101404759"></p>
<h3 id="4-2-控制LED亮灭"><a href="#4-2-控制LED亮灭" class="headerlink" title="4.2 控制LED亮灭"></a>4.2 控制LED亮灭</h3><p>效果：按下按键K1（注意编号为<code>P31</code>），LED D1（编号<code>P20</code>）亮，松开按键K1，LED D1灭。</p>
<hr>
<p><code>REGX52.H</code>头文件中，不仅定义了8位寄存器的变量（以<code>sfr</code>修饰），还定义了针对8位寄存器每1位的单独变量（以<code>sbit</code>修饰），例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*------------------------------------------------</span></span><br><span class="line"><span class="comment">Byte Registers</span></span><br><span class="line"><span class="comment">------------------------------------------------*/</span></span><br><span class="line">sfr P2      = <span class="number">0xA0</span>; <span class="comment">// 8位寄存器变量P2</span></span><br><span class="line"><span class="comment">/*------------------------------------------------</span></span><br><span class="line"><span class="comment">P2 Bit Registers</span></span><br><span class="line"><span class="comment">------------------------------------------------*/</span></span><br><span class="line">sbit P2_0 = <span class="number">0xA0</span>; <span class="comment">// P20 低位，0xA0是位地址</span></span><br><span class="line">sbit P2_1 = <span class="number">0xA1</span>;</span><br><span class="line">sbit P2_2 = <span class="number">0xA2</span>;</span><br><span class="line">sbit P2_3 = <span class="number">0xA3</span>;</span><br><span class="line">sbit P2_4 = <span class="number">0xA4</span>;</span><br><span class="line">sbit P2_5 = <span class="number">0xA5</span>;</span><br><span class="line">sbit P2_6 = <span class="number">0xA6</span>;</span><br><span class="line">sbit P2_7 = <span class="number">0xA7</span>; <span class="comment">// P27 高位</span></span><br></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>代码实现</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(P3_1 == <span class="number">0</span>) &#123; <span class="comment">// 如果P31口为低电平（即按下按键K1，使得P31接地了）</span></span><br><span class="line">			P2_0 = <span class="number">0</span>; <span class="comment">// 让P20口输出低电平，使LED亮</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123; <span class="comment">// 松开K1</span></span><br><span class="line">			P2_0 = <span class="number">1</span>; <span class="comment">// 让P20口输出高电平，使LED灭</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-3-控制LED状态"><a href="#4-3-控制LED状态" class="headerlink" title="4.3 控制LED状态"></a>4.3 控制LED状态</h3><p>效果：按一下按键K1，LED D1亮，再按一下，LED灭</p>
<p>按键的抖动：对于机械开关，当机械触点断开、闭合时，由于机械触点的弹性作用，一个开关在闭合时不会马上稳定地接通，在断开时也不会一下子断开，所以在开关闭合及断开的瞬间会伴随一连串的抖动。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221112131658891.png" alt="image-20221112131658891"></p>
<p>消抖有两种策略：</p>
<ul>
<li>硬件消抖：在电路中加入电容</li>
<li>软件消抖：加入延时函数</li>
</ul>
<blockquote>
<p>代码实现</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i, j;</span><br><span class="line">	<span class="keyword">while</span>(n) &#123;</span><br><span class="line">		i = <span class="number">2</span>;</span><br><span class="line">		j = <span class="number">239</span>;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (--j);</span><br><span class="line">		&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">		n--;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(P3_1 == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 按下时的消抖</span></span><br><span class="line">			Delay(<span class="number">20</span>);</span><br><span class="line">			<span class="keyword">while</span>(P3_1 == <span class="number">0</span>); <span class="comment">// 如果按住不松手的话，一直循环</span></span><br><span class="line">            <span class="comment">// 松开时的消抖</span></span><br><span class="line">			Delay(<span class="number">20</span>);</span><br><span class="line">			P2_0 = ~P2_0; <span class="comment">// 亮灭状态取反</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-4-控制LED显示二进制"><a href="#4-4-控制LED显示二进制" class="headerlink" title="4.4 控制LED显示二进制"></a>4.4 控制LED显示二进制</h3><p>效果：每按一次K1，LED按照二进制递增的顺序进行亮灭。</p>
<blockquote>
<p>实现代码</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i, j;</span><br><span class="line">	<span class="keyword">while</span>(n) &#123;</span><br><span class="line">		i = <span class="number">2</span>;</span><br><span class="line">		j = <span class="number">239</span>;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (--j);</span><br><span class="line">		&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">		n--;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// unsigned char为8位正值，常用来代表一个8位寄存器</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> LEDNum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(P3_1 == <span class="number">0</span>) &#123;</span><br><span class="line">			Delay(<span class="number">20</span>);</span><br><span class="line">			<span class="keyword">while</span>(P3_1 == <span class="number">0</span>);</span><br><span class="line">			Delay(<span class="number">20</span>);</span><br><span class="line">			<span class="comment">// 单片机上电后，端口为高电平</span></span><br><span class="line">            <span class="comment">// 因此P2的初始值为1111 1111</span></span><br><span class="line">            LEDNum++;</span><br><span class="line">            P2 = ~LEDNum;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述程序：</p>
<ul>
<li>第一次按下时，<code>LEDNum=0000 0001</code>，取反为<code>LEDNum=1111 1110</code>，并赋值给P2，使得最后一位（P2_0）的LED亮。</li>
<li>第二次按下时，<code>LEDNum=0000 0010</code>，取反为<code>LEDNum=1111 1101</code>，并赋值给P2，使得P2_1的LED亮。</li>
<li>以此类推</li>
</ul>
<h3 id="4-5-控制LED移位"><a href="#4-5-控制LED移位" class="headerlink" title="4.5 控制LED移位"></a>4.5 控制LED移位</h3><p>效果：每按一次K1，LED从低位到高位，一次移动一位亮。每按一次K2，LED从高位到低位，一次移动一位亮。</p>
<ul>
<li>P2寄存器需要的变化：<ul>
<li><code>1111 1110</code>—&gt;<code>1111 1101</code>—&gt;<code>1111 1011</code>…</li>
</ul>
</li>
<li>取反后相应的变化：<ul>
<li><code>0000 0001</code>—&gt;<code>0000 0010</code>—&gt;<code>0000 0100</code>…</li>
<li>即<code>0000 0001</code>向左进行移位，按多少次，就移动多少位</li>
</ul>
</li>
</ul>
<blockquote>
<p>代码实现</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i, j;</span><br><span class="line">	<span class="keyword">while</span>(n) &#123;</span><br><span class="line">		i = <span class="number">2</span>;</span><br><span class="line">		j = <span class="number">239</span>;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (--j);</span><br><span class="line">		&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">		n--;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> LEDNum = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 先让最低位的LED亮，初始状态</span></span><br><span class="line">	P2 = ~<span class="number">0x01</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(P3_1 == <span class="number">0</span>) &#123;</span><br><span class="line">			Delay(<span class="number">20</span>);</span><br><span class="line">			<span class="keyword">while</span>(P3_1 == <span class="number">0</span>);</span><br><span class="line">			Delay(<span class="number">20</span>);</span><br><span class="line">			LEDNum++;</span><br><span class="line">			<span class="keyword">if</span>(LEDNum &gt;= <span class="number">8</span>)</span><br><span class="line">				LEDNum = <span class="number">0</span>;</span><br><span class="line">			P2 = ~(<span class="number">0x01</span>&lt;&lt;LEDNum);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(P3_0 == <span class="number">0</span>) &#123;</span><br><span class="line">			Delay(<span class="number">20</span>);</span><br><span class="line">			<span class="keyword">while</span>(P3_0 == <span class="number">0</span>);</span><br><span class="line">			Delay(<span class="number">20</span>);</span><br><span class="line">			<span class="keyword">if</span>(LEDNum == <span class="number">0</span>)</span><br><span class="line">				LEDNum = <span class="number">7</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				LEDNum--;</span><br><span class="line">			P2 = ~(<span class="number">0x01</span>&lt;&lt;LEDNum);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-数码管"><a href="#5-数码管" class="headerlink" title="5 数码管"></a>5 数码管</h2><h3 id="5-1-静态数码管显示"><a href="#5-1-静态数码管显示" class="headerlink" title="5.1 静态数码管显示"></a>5.1 静态数码管显示</h3><h4 id="5-1-1-概述"><a href="#5-1-1-概述" class="headerlink" title="5.1.1 概述"></a>5.1.1 概述</h4><p>LED数码管：数码管是一种简单、廉价的显示器，是由多个发光二极管封装在一起组成“8”字型的器件。</p>
<blockquote>
<p>一位数码管</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221113091929288.png" alt="image-20221113091929288"></p>
<p>分为<strong>共阴极COM</strong>连接和<strong>共阳极GRN</strong>连接两种连接方式：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221113091956859.png" alt="image-20221113091956859"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221113091959469.png" alt="image-20221113091959469"></p>
<ul>
<li>引脚连接</li>
</ul>
<p>以共阳极（上面的下图）为例，3和8号引脚接至正极，A号LED负极引脚编号为7，以此类推。</p>
<blockquote>
<p>多位数码管</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221113092547876.png" alt="image-20221113092547876"></p>
<p>也分为<strong>共阴极</strong>连接和<strong>共阳极</strong>连接两种连接方式：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221113092603250.png" alt="image-20221113092603250"></p>
<h4 id="5-1-2-电路原理图"><a href="#5-1-2-电路原理图" class="headerlink" title="5.1.2 电路原理图"></a>5.1.2 电路原理图</h4><ul>
<li>动态数码管模块</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221113093616534.png" alt="image-20221113093616534"></p>
<p>其中74HC245是一个双向数据缓冲器，端口是一一对应的关系，作用是<strong>提供驱动能力</strong>（如果去掉，则P传过来的信号直接当做驱动，给LED的阳极供电，反之，加上缓冲器后，P传过来的信号只是当做<strong>控制信号</strong>，即使很微弱也能区分相对的正负，之后再由74HC245的VCC直接给LED提供电源驱动，使得LED更亮）。<code>DIR</code>控制数据流向，高电平为从左到右（右边读左边），低电平从右到左（左边读右边），图中<code>DIR</code>接电源，则上电后为右边读左边，有的单片机该端口接的是跳线帽<code>Jxx</code>。</p>
<ul>
<li>74H138译码器</li>
</ul>
<p>输入端：<code>P22~P24</code>，高位到低位：<code>CBA</code></p>
<p>输出端<code>Y0~Y7</code></p>
<p>使能端<code>G1~G2</code>：单片机上电就使能。</p>
<p>例如，输入CBA为<code>101</code>（二进制），换算成十进制为<code>5</code>，则选中<code>Y5</code>使能，其余失效。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221113100059191.png" alt="image-20221113100059191"></p>
<h4 id="5-1-3-代码实现"><a href="#5-1-3-代码实现" class="headerlink" title="5.1.3 代码实现"></a>5.1.3 代码实现</h4><p>效果：点亮LED6，并显示<code>6</code></p>
<blockquote>
<p>代码实现</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	P2_4 = <span class="number">1</span>;</span><br><span class="line">	P2_3 = <span class="number">0</span>;</span><br><span class="line">	P2_2 = <span class="number">1</span>;</span><br><span class="line">	P0 = <span class="number">0x7D</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序解析：</p>
<ul>
<li>在译码器中，LED6对应Y5，因此输入端二进制应该为<code>101</code></li>
<li><code>abcdefg(dp)</code>亮的为<code>acdefg</code>，因此LED段码为：<code>0111 1101</code>，对应十六进制<code>0x7D</code></li>
</ul>
<blockquote>
<p>代码优化</p>
</blockquote>
<p>构造一个函数<code>Nixie</code>，接收参数控制哪个LED亮，以及亮的数字</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> NixieTable[] = &#123;</span><br><span class="line">	<span class="number">0x3F</span>,<span class="number">0x06</span>,<span class="number">0x5B</span>,<span class="number">0x4F</span>,<span class="number">0x66</span>,<span class="number">0x6D</span>,<span class="number">0x7D</span>,<span class="number">0x07</span>,<span class="number">0x7F</span>,<span class="number">0x6F</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示的位置(1-8)和数字(0-9)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Nixie</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> loc, num)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(loc) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">8</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	P0 = NixieTable[num];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Nixie(<span class="number">1</span>, <span class="number">9</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-动态数码管显示"><a href="#5-2-动态数码管显示" class="headerlink" title="5.2 动态数码管显示"></a>5.2 动态数码管显示</h3><p>所谓动态显示，是指多个数码管<strong>同时亮起</strong>，实际上从电路原理图来看，在确定的某一时刻，只能有一个数码管亮（译码器只能送一个确定的值来决定位选）；但是<strong>单片机执行指令速度很快，人眼具有视觉暂留</strong>，因此看起来像是多个数码管同时亮了起来。</p>
<p>数码管显示通常以<code>位选 段选 位选 段选...</code>的顺序来执行，其中，位选是选择哪一个数码管亮，段选是数码管中的LED哪些亮，以形成一个数字或某种形状。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		Nixie(<span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 位选1，段选的形状为1</span></span><br><span class="line">		Nixie(<span class="number">2</span>, <span class="number">2</span>); <span class="comment">// 位选2，段选的形状为2</span></span><br><span class="line">		Nixie(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>消隐：单片机执行速度很快，以<code>位选 段选 位选 段选...</code>的顺序执行时，段选码可能会<strong>窜到</strong>位选码的位置上，导致错误。在数码动态显示过程中，<strong>若进行位选切换时没有对上一位显示的内容进行清空</strong>，则会导致当前数码管中出现上一片内容的余影，从而使显示模糊，影响了整个显示效果。</p>
<p>解决方法：在数码管位选信号切换前，先向段传送“不亮”字型码，然后在进行切换和正常传递新段码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221115100921700.png" alt="image-20221115100921700"></p>
<blockquote>
<p>实现代码</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> NixieTable[] = &#123;</span><br><span class="line">	<span class="number">0x3F</span>,<span class="number">0x06</span>,<span class="number">0x5B</span>,<span class="number">0x4F</span>,<span class="number">0x66</span>,<span class="number">0x6D</span>,<span class="number">0x7D</span>,<span class="number">0x07</span>,<span class="number">0x7F</span>,<span class="number">0x6F</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i, j;</span><br><span class="line">	<span class="keyword">while</span>(n) &#123;</span><br><span class="line">		i = <span class="number">2</span>;</span><br><span class="line">		j = <span class="number">239</span>;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (--j);</span><br><span class="line">		&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">		n--;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Nixie</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> loc, num)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(loc) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">8</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	P0 = NixieTable[num]; <span class="comment">// 段选</span></span><br><span class="line">	Delay(<span class="number">1</span>); <span class="comment">// 延时，让LED更亮</span></span><br><span class="line">	P0 = <span class="number">0x00</span>; <span class="comment">// 段选清零，让其不亮</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		Nixie(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">		Nixie(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">		Nixie(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数码管驱动方式：</p>
<ul>
<li>单片机直接扫描：硬件设备简单，但会耗费大量的单片机CPU时间</li>
<li>专用驱动芯片：内部自带显存、扫描电路，单片机只需告诉它显示什么即可</li>
</ul>
<h2 id="6-模块化编程和LCD"><a href="#6-模块化编程和LCD" class="headerlink" title="6 模块化编程和LCD"></a>6 模块化编程和LCD</h2><h3 id="6-1-简介"><a href="#6-1-简介" class="headerlink" title="6.1 简介"></a>6.1 简介</h3><p>传统方式编程：所有的函数均放在<code>main.c</code>里，若使用的模块比较多，则一个文件内会有很多的代码，不利于代码的组织和管理，而且很影响编程者的思路。</p>
<p>模块化编程：把各个模块的代码放在不同的<code>.c</code>文件里，在<code>.h</code>文件里提供外部可调用函数的<strong>声明</strong>，其它<code>.c</code>文件想使用其中的代码时，只需要<code>#include &quot;XXX.h&quot;</code>文件即可。使用模块化编程可极大的提高代码的可阅读性、可维护性、可移植性等。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221115104229885.png" alt="image-20221115104229885"></p>
<p>注意事项：</p>
<ul>
<li>.c文件：函数、变量的定义</li>
<li>.h文件：可被外部调用的函数、变量的<strong>声明</strong></li>
<li>任何自定义的变量、函数在调用前必须有定义或声明（同一个.c）</li>
<li>使用到的自定义函数的.c文件必须添加到工程参与编译</li>
<li>使用到的.h文件必须要放在编译器可寻找到的地方（工程文件夹根目录、安装目录、自定义）</li>
</ul>
<h3 id="6-2-预编译"><a href="#6-2-预编译" class="headerlink" title="6.2 预编译"></a>6.2 预编译</h3><p>C语言的预编译以<code>#</code>开头，作用是在真正的编译开始之前，对代码做一些处理（预编译）。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>预编译</strong></th>
<th><strong>意义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>#include &lt;REGX52.H&gt;</code></td>
<td>把<code>REGX52.H</code>文件的内容搬到此处</td>
</tr>
<tr>
<td><code>#define PI 3.14</code></td>
<td>定义PI，将PI替换为3.14</td>
</tr>
<tr>
<td><code>#define ABC</code></td>
<td>定义ABC</td>
</tr>
<tr>
<td><code>#ifndef __XX_H__</code></td>
<td>如果没有定义<code>__XX_H__</code></td>
</tr>
<tr>
<td><code>#endif</code></td>
<td>与<code>#ifndef</code>,<code>#if</code>匹配，组成“括号”</td>
</tr>
</tbody>
</table>
</div>
<p>此外还有<code>#ifdef</code>,<code>#if</code>,<code>#else</code>,<code>#elif</code>,<code>#undef</code>等</p>
<h3 id="6-3-模块化实现"><a href="#6-3-模块化实现" class="headerlink" title="6.3 模块化实现"></a>6.3 模块化实现</h3><p>需求：将延时函数和数码管显示的函数模块化。</p>
<ul>
<li>项目结构：</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221115111034058.png" alt="image-20221115111034058"></p>
<blockquote>
<p>代码实现</p>
</blockquote>
<ul>
<li><code>Delay.c</code>和<code>Delay.h</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i, j;</span><br><span class="line">	<span class="keyword">while</span>(n) &#123;</span><br><span class="line">		i = <span class="number">2</span>;</span><br><span class="line">		j = <span class="number">239</span>;</span><br><span class="line">		<span class="keyword">do</span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (--j);</span><br><span class="line">		&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">		n--;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __Delay_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>	__Delay_H_</span></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>Nixie.c</code>和<code>Nixie.h</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> NixieTable[] = &#123;</span><br><span class="line">	<span class="number">0x3F</span>,<span class="number">0x06</span>,<span class="number">0x5B</span>,<span class="number">0x4F</span>,<span class="number">0x66</span>,<span class="number">0x6D</span>,<span class="number">0x7D</span>,<span class="number">0x07</span>,<span class="number">0x7F</span>,<span class="number">0x6F</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Nixie</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> loc, num)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(loc) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>: </span><br><span class="line">			P2_4 = <span class="number">1</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">1</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">8</span>: </span><br><span class="line">			P2_4 = <span class="number">0</span>; P2_3 = <span class="number">0</span>; P2_2 = <span class="number">0</span>;<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	P0 = NixieTable[num]; <span class="comment">// 段选</span></span><br><span class="line">	Delay(<span class="number">1</span>); <span class="comment">// 延时，让LED更亮</span></span><br><span class="line">	P0 = <span class="number">0x00</span>; <span class="comment">// 段选清零，让其不亮</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __Nixie_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>	__Nixie_H__</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Nixie</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> loc, num)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>main.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Nixie.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		Nixie(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">		Nixie(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">		Nixie(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">		Nixie(<span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">		Nixie(<span class="number">5</span>, <span class="number">5</span>);</span><br><span class="line">		Nixie(<span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line">		Nixie(<span class="number">7</span>, <span class="number">7</span>);</span><br><span class="line">		Nixie(<span class="number">8</span>, <span class="number">8</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-4-LCD1602调试工具"><a href="#6-4-LCD1602调试工具" class="headerlink" title="6.4 LCD1602调试工具"></a>6.4 LCD1602调试工具</h3><h4 id="6-4-1-原理图"><a href="#6-4-1-原理图" class="headerlink" title="6.4.1 原理图"></a>6.4.1 原理图</h4><p>使用<code>LCD1602</code>液晶屏作为调试窗口，提供类似printf函数的功能，可实时观察单片机内部数据的变换情况，便于调试和演示。</p>
<p>本视频提供的LCD1602代码属于模块化的代码，使用者只需要知道所提供函数的作用和使用方法就可以很容易的使用LCD1602。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>函数</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LCD_Init();</code></td>
<td>初始化</td>
</tr>
<tr>
<td><code>LCD_ShowChar(1,1,&#39;A&#39;);</code></td>
<td>显示一个字符</td>
</tr>
<tr>
<td><code>LCD_ShowString(1,3,&quot;Hello&quot;);</code></td>
<td>显示字符串</td>
</tr>
<tr>
<td><code>LCD_ShowNum(1,9,123,3);</code></td>
<td>显示十进制数字</td>
</tr>
<tr>
<td><code>LCD_ShowSignedNum(1,13,-66,2);</code></td>
<td>显示有符号十进制数字</td>
</tr>
<tr>
<td><code>LCD_ShowHexNum(2,1,0xA8,2);</code></td>
<td>显示十六进制数字</td>
</tr>
<tr>
<td><code>LCD_ShowBinNum(2,4,0xAA,8);</code></td>
<td>显示二进制数字</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//引脚配置：</span></span><br><span class="line">sbit LCD_RS=P2^<span class="number">6</span>;</span><br><span class="line">sbit LCD_RW=P2^<span class="number">5</span>;</span><br><span class="line">sbit LCD_EN=P2^<span class="number">7</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_DataPort P0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//函数定义：</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  LCD1602延时函数，12MHz调用可延时1ms</span></span><br><span class="line"><span class="comment">  * @param  无</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_Delay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i, j;</span><br><span class="line"></span><br><span class="line">	i = <span class="number">2</span>;</span><br><span class="line">	j = <span class="number">239</span>;</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span> (--j);</span><br><span class="line">	&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  LCD1602写命令</span></span><br><span class="line"><span class="comment">  * @param  Command 要写入的命令</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_WriteCommand</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Command)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LCD_RS=<span class="number">0</span>;</span><br><span class="line">	LCD_RW=<span class="number">0</span>;</span><br><span class="line">	LCD_DataPort=Command;</span><br><span class="line">	LCD_EN=<span class="number">1</span>;</span><br><span class="line">	LCD_Delay();</span><br><span class="line">	LCD_EN=<span class="number">0</span>;</span><br><span class="line">	LCD_Delay();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  LCD1602写数据</span></span><br><span class="line"><span class="comment">  * @param  Data 要写入的数据</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_WriteData</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LCD_RS=<span class="number">1</span>;</span><br><span class="line">	LCD_RW=<span class="number">0</span>;</span><br><span class="line">	LCD_DataPort=Data;</span><br><span class="line">	LCD_EN=<span class="number">1</span>;</span><br><span class="line">	LCD_Delay();</span><br><span class="line">	LCD_EN=<span class="number">0</span>;</span><br><span class="line">	LCD_Delay();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  LCD1602设置光标位置</span></span><br><span class="line"><span class="comment">  * @param  Line 行位置，范围：1~2</span></span><br><span class="line"><span class="comment">  * @param  Column 列位置，范围：1~16</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_SetCursor</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(Line==<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		LCD_WriteCommand(<span class="number">0x80</span>|(Column<span class="number">-1</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(Line==<span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		LCD_WriteCommand(<span class="number">0x80</span>|(Column<span class="number">-1</span>+<span class="number">0x40</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  LCD1602初始化函数</span></span><br><span class="line"><span class="comment">  * @param  无</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LCD_WriteCommand(<span class="number">0x38</span>);<span class="comment">//八位数据接口，两行显示，5*7点阵</span></span><br><span class="line">	LCD_WriteCommand(<span class="number">0x0c</span>);<span class="comment">//显示开，光标关，闪烁关</span></span><br><span class="line">	LCD_WriteCommand(<span class="number">0x06</span>);<span class="comment">//数据读写操作后，光标自动加一，画面不动</span></span><br><span class="line">	LCD_WriteCommand(<span class="number">0x01</span>);<span class="comment">//光标复位，清屏</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  在LCD1602指定位置上显示一个字符</span></span><br><span class="line"><span class="comment">  * @param  Line 行位置，范围：1~2</span></span><br><span class="line"><span class="comment">  * @param  Column 列位置，范围：1~16</span></span><br><span class="line"><span class="comment">  * @param  Char 要显示的字符</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowChar</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">char</span> Char)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LCD_SetCursor(Line,Column);</span><br><span class="line">	LCD_WriteData(Char);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  在LCD1602指定位置开始显示所给字符串</span></span><br><span class="line"><span class="comment">  * @param  Line 起始行位置，范围：1~2</span></span><br><span class="line"><span class="comment">  * @param  Column 起始列位置，范围：1~16</span></span><br><span class="line"><span class="comment">  * @param  String 要显示的字符串</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowString</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">char</span> *String)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line">	LCD_SetCursor(Line,Column);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;String[i]!=<span class="string">&#x27;\0&#x27;</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		LCD_WriteData(String[i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  返回值=X的Y次方</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCD_Pow</span><span class="params">(<span class="keyword">int</span> X,<span class="keyword">int</span> Y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line">	<span class="keyword">int</span> Result=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;Y;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		Result*=X;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  在LCD1602指定位置开始显示所给数字</span></span><br><span class="line"><span class="comment">  * @param  Line 起始行位置，范围：1~2</span></span><br><span class="line"><span class="comment">  * @param  Column 起始列位置，范围：1~16</span></span><br><span class="line"><span class="comment">  * @param  Number 要显示的数字，范围：0~65535</span></span><br><span class="line"><span class="comment">  * @param  Length 要显示数字的长度，范围：1~5</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowNum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">unsigned</span> <span class="keyword">int</span> Number,<span class="keyword">unsigned</span> <span class="keyword">char</span> Length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line">	LCD_SetCursor(Line,Column);</span><br><span class="line">	<span class="keyword">for</span>(i=Length;i&gt;<span class="number">0</span>;i--)</span><br><span class="line">	&#123;</span><br><span class="line">		LCD_WriteData(Number/LCD_Pow(<span class="number">10</span>,i<span class="number">-1</span>)%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  在LCD1602指定位置开始以有符号十进制显示所给数字</span></span><br><span class="line"><span class="comment">  * @param  Line 起始行位置，范围：1~2</span></span><br><span class="line"><span class="comment">  * @param  Column 起始列位置，范围：1~16</span></span><br><span class="line"><span class="comment">  * @param  Number 要显示的数字，范围：-32768~32767</span></span><br><span class="line"><span class="comment">  * @param  Length 要显示数字的长度，范围：1~5</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowSignedNum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">int</span> Number,<span class="keyword">unsigned</span> <span class="keyword">char</span> Length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> Number1;</span><br><span class="line">	LCD_SetCursor(Line,Column);</span><br><span class="line">	<span class="keyword">if</span>(Number&gt;=<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		LCD_WriteData(<span class="string">&#x27;+&#x27;</span>);</span><br><span class="line">		Number1=Number;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		LCD_WriteData(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">		Number1=-Number;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(i=Length;i&gt;<span class="number">0</span>;i--)</span><br><span class="line">	&#123;</span><br><span class="line">		LCD_WriteData(Number1/LCD_Pow(<span class="number">10</span>,i<span class="number">-1</span>)%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  在LCD1602指定位置开始以十六进制显示所给数字</span></span><br><span class="line"><span class="comment">  * @param  Line 起始行位置，范围：1~2</span></span><br><span class="line"><span class="comment">  * @param  Column 起始列位置，范围：1~16</span></span><br><span class="line"><span class="comment">  * @param  Number 要显示的数字，范围：0~0xFFFF</span></span><br><span class="line"><span class="comment">  * @param  Length 要显示数字的长度，范围：1~4</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowHexNum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">unsigned</span> <span class="keyword">int</span> Number,<span class="keyword">unsigned</span> <span class="keyword">char</span> Length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i,SingleNumber;</span><br><span class="line">	LCD_SetCursor(Line,Column);</span><br><span class="line">	<span class="keyword">for</span>(i=Length;i&gt;<span class="number">0</span>;i--)</span><br><span class="line">	&#123;</span><br><span class="line">		SingleNumber=Number/LCD_Pow(<span class="number">16</span>,i<span class="number">-1</span>)%<span class="number">16</span>;</span><br><span class="line">		<span class="keyword">if</span>(SingleNumber&lt;<span class="number">10</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			LCD_WriteData(SingleNumber+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			LCD_WriteData(SingleNumber<span class="number">-10</span>+<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  在LCD1602指定位置开始以二进制显示所给数字</span></span><br><span class="line"><span class="comment">  * @param  Line 起始行位置，范围：1~2</span></span><br><span class="line"><span class="comment">  * @param  Column 起始列位置，范围：1~16</span></span><br><span class="line"><span class="comment">  * @param  Number 要显示的数字，范围：0~1111 1111 1111 1111</span></span><br><span class="line"><span class="comment">  * @param  Length 要显示数字的长度，范围：1~16</span></span><br><span class="line"><span class="comment">  * @retval 无</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowBinNum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">unsigned</span> <span class="keyword">int</span> Number,<span class="keyword">unsigned</span> <span class="keyword">char</span> Length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line">	LCD_SetCursor(Line,Column);</span><br><span class="line">	<span class="keyword">for</span>(i=Length;i&gt;<span class="number">0</span>;i--)</span><br><span class="line">	&#123;</span><br><span class="line">		LCD_WriteData(Number/LCD_Pow(<span class="number">2</span>,i<span class="number">-1</span>)%<span class="number">2</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __LCD1602_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __LCD1602_H__</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用户调用函数：</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_Init</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowChar</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">char</span> Char)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowString</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">char</span> *String)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowNum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">unsigned</span> <span class="keyword">int</span> Number,<span class="keyword">unsigned</span> <span class="keyword">char</span> Length)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowSignedNum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">int</span> Number,<span class="keyword">unsigned</span> <span class="keyword">char</span> Length)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowHexNum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">unsigned</span> <span class="keyword">int</span> Number,<span class="keyword">unsigned</span> <span class="keyword">char</span> Length)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_ShowBinNum</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Line,<span class="keyword">unsigned</span> <span class="keyword">char</span> Column,<span class="keyword">unsigned</span> <span class="keyword">int</span> Number,<span class="keyword">unsigned</span> <span class="keyword">char</span> Length)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>电路原理图</p>
</blockquote>
<ul>
<li>LCD1602接口</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221115113003628.png" alt="image-20221115113003628"></p>
<ul>
<li>cpu</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img19/image-20221115113042232.png" alt="image-20221115113042232"></p>
<p>由图可知，LCD的八个引脚<code>LCD D0 ~ LCD D7</code>与cpu的P0寄存器的<code>P0 ~ P7</code>相连</p>
<h4 id="6-4-2-代码示例"><a href="#6-4-2-代码示例" class="headerlink" title="6.4.2 代码示例"></a>6.4.2 代码示例</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LCD1602.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	LCD_Init();</span><br><span class="line">	LCD_ShowChar(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">	LCD_ShowString(<span class="number">1</span>, <span class="number">3</span>, <span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">	LCD_ShowNum(<span class="number">2</span>, <span class="number">1</span>, <span class="number">123</span>, <span class="number">3</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-矩阵键盘"><a href="#7-矩阵键盘" class="headerlink" title="7 矩阵键盘"></a>7 矩阵键盘</h2><h3 id="7-1-简介"><a href="#7-1-简介" class="headerlink" title="7.1 简介"></a>7.1 简介</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117155801715.png" alt="image-20221117155801715"></p>
<p>在键盘中按键数量较多时，为了减少I/O口的占用，通常将按键排列成矩阵形式。</p>
<p>采用逐行或逐列的“扫描”，就可以读出任何位置按键的状态。</p>
<blockquote>
<p>扫描</p>
</blockquote>
<ul>
<li>数码管扫描（输出扫描）    原理：显示第1位→显示第2位→显示第3位→……，然后快速循环这个过程，最终实现所有数码管<strong>同时显示</strong>的效果</li>
<li>矩阵键盘扫描（输入扫描）    原理：读取第1行(列)→读取第2行(列) →读取第3行(列) → ……，然后快速循环这个过程，最终实现所有按键<strong>同时检测</strong>的效果</li>
</ul>
<p>以上两种扫描方式的共性：<strong>节省I/O口</strong>。</p>
<h3 id="7-2-原理图"><a href="#7-2-原理图" class="headerlink" title="7.2 原理图"></a>7.2 原理图</h3><blockquote>
<p>矩阵按键</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117160609682.png" alt="image-20221117160609682"></p>
<p>通过原理图可知，<code>P17~P14</code>连接按键的左端，<code>P13~P10</code>连接按键的右端</p>
<ul>
<li>按行扫描：<ul>
<li>扫描第一行：给定<code>P17~P14</code>为<code>0111</code>，当<code>P13~P10</code>的哪一位为0，则<code>S1~S4</code>对应的被按下。例如<code>P13</code>为0，则<code>S1</code>被按下。</li>
<li>扫描第二行：给定<code>P17~P14</code>为<code>1011</code>，当<code>P13~P10</code>的哪一位为0，则<code>S5~S8</code>对应的被按下。例如<code>P13</code>为0，则<code>S5</code>被按下。</li>
<li>以此类推</li>
</ul>
</li>
<li>按列扫描：<ul>
<li>扫描第一列：给定<code>P13~P10</code>为<code>0111</code>，当<code>P17~P14</code>的哪一位为0，则<code>S1,S5,S9,S13</code>对应的被按下。</li>
<li>以此类推</li>
</ul>
</li>
</ul>
<blockquote>
<p>单片机核心</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117162805282.png" alt="image-20221117162805282"></p>
<h3 id="7-3-矩阵键盘"><a href="#7-3-矩阵键盘" class="headerlink" title="7.3 矩阵键盘"></a>7.3 矩阵键盘</h3><p>效果：采用列扫描；按下一个按键，在LCD显示屏上显示按键的序号。</p>
<hr>
<p>可以为头文件新建一个模板（代码片段）：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117163406228.png" alt="image-20221117163406228"></p>
<hr>
<ul>
<li><code>MatrixKey.c</code>和头文件</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	* @brief 矩阵键盘按键检测</span></span><br><span class="line"><span class="comment">	* @param 无</span></span><br><span class="line"><span class="comment">	* @retval keyNumber 按下按键的序号</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">MatrixKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> keyNumber = <span class="number">0</span>; <span class="comment">// 按下的按键的序号</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 按列扫描</span></span><br><span class="line">	P1 = <span class="number">0xFF</span>; <span class="comment">// 先全部置1</span></span><br><span class="line">	P1_3 = <span class="number">0</span>; <span class="comment">// 扫描第1列</span></span><br><span class="line">	<span class="keyword">if</span> (P1_7 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_7 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_6 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_6 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">5</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_5 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_5 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">9</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_4 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_4 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">13</span>;&#125;</span><br><span class="line">	</span><br><span class="line">	P1 = <span class="number">0xFF</span>; <span class="comment">// 先全部置1</span></span><br><span class="line">	P1_2 = <span class="number">0</span>; <span class="comment">// 扫描第2列</span></span><br><span class="line">	<span class="keyword">if</span> (P1_7 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_7 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">2</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_6 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_6 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">6</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_5 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_5 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">10</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_4 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_4 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">14</span>;&#125;</span><br><span class="line">	</span><br><span class="line">	P1 = <span class="number">0xFF</span>; <span class="comment">// 先全部置1</span></span><br><span class="line">	P1_1 = <span class="number">0</span>; <span class="comment">// 扫描第3列</span></span><br><span class="line">	<span class="keyword">if</span> (P1_7 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_7 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">3</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_6 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_6 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">7</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_5 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_5 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">11</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_4 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_4 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">15</span>;&#125;</span><br><span class="line">	</span><br><span class="line">	P1 = <span class="number">0xFF</span>; <span class="comment">// 先全部置1</span></span><br><span class="line">	P1_0 = <span class="number">0</span>; <span class="comment">// 扫描第4列</span></span><br><span class="line">	<span class="keyword">if</span> (P1_7 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_7 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">4</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_6 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_6 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">8</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_5 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_5 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">12</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (P1_4 == <span class="number">0</span>) &#123;Delay(<span class="number">20</span>);<span class="keyword">while</span>(P1_4 == <span class="number">0</span>);Delay(<span class="number">20</span>);keyNumber = <span class="number">16</span>;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> keyNumber;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __MATRIXKEY_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __MATRIXKEY_H__</span></span><br><span class="line">	<span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">MatrixKey</span><span class="params">()</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>main.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LCD1602.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;MatrixKey.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> keyNumber;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	LCD_Init();</span><br><span class="line">	LCD_ShowString(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;HelloWorld&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		keyNumber = MatrixKey();</span><br><span class="line">		<span class="keyword">if</span>(keyNumber) &#123;</span><br><span class="line">			LCD_ShowNum(<span class="number">2</span>, <span class="number">1</span>, keyNumber, <span class="number">2</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-4-密码锁"><a href="#7-4-密码锁" class="headerlink" title="7.4 密码锁"></a>7.4 密码锁</h3><p>效果：<code>S1~S9</code>定义为输入的数字，<code>S10</code>为0，<code>S11</code>为确认，<code>S12</code>为取消。</p>
<ul>
<li>代码实现</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LCD1602.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;MatrixKey.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> keyNumber;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> password, count;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	LCD_Init();</span><br><span class="line">	LCD_ShowString(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;Password:&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		keyNumber = MatrixKey();</span><br><span class="line">		<span class="keyword">if</span>(keyNumber) &#123;</span><br><span class="line">			<span class="keyword">if</span>(keyNumber &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>(count &lt; <span class="number">4</span>) &#123; <span class="comment">// 假设只输入4位密码</span></span><br><span class="line">					password *= <span class="number">10</span>; <span class="comment">// 相当于密码左移</span></span><br><span class="line">					password += (keyNumber % <span class="number">10</span>); <span class="comment">// 获取一位密码</span></span><br><span class="line">					count++;</span><br><span class="line">				&#125;</span><br><span class="line">				LCD_ShowNum(<span class="number">2</span>, <span class="number">1</span>, password, <span class="number">4</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(keyNumber == <span class="number">11</span>) &#123; <span class="comment">// 确认键</span></span><br><span class="line">				<span class="keyword">if</span> (password == <span class="number">2345</span>) &#123; <span class="comment">// 密码正确</span></span><br><span class="line">					LCD_ShowString(<span class="number">1</span>, <span class="number">14</span>, <span class="string">&quot;OK &quot;</span>);</span><br><span class="line">					password = <span class="number">0</span>; <span class="comment">// 输入清零</span></span><br><span class="line">					count = <span class="number">0</span>; <span class="comment">// 计数清零</span></span><br><span class="line">					LCD_ShowNum(<span class="number">2</span>, <span class="number">1</span>, password, <span class="number">4</span>); <span class="comment">// 更新显示</span></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123; <span class="comment">// 密码错误</span></span><br><span class="line">					LCD_ShowString(<span class="number">1</span>, <span class="number">14</span>, <span class="string">&quot;ERR&quot;</span>);</span><br><span class="line">					password = <span class="number">0</span>; <span class="comment">// 输入清零</span></span><br><span class="line">					count = <span class="number">0</span>; <span class="comment">// 计数清零</span></span><br><span class="line">					LCD_ShowNum(<span class="number">2</span>, <span class="number">1</span>, password, <span class="number">4</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(keyNumber == <span class="number">12</span>) &#123;</span><br><span class="line">				password = <span class="number">0</span>; <span class="comment">// 输入清零</span></span><br><span class="line">				count = <span class="number">0</span>; <span class="comment">// 计数清零</span></span><br><span class="line">				LCD_ShowNum(<span class="number">2</span>, <span class="number">1</span>, password, <span class="number">4</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-定时器"><a href="#8-定时器" class="headerlink" title="8 定时器"></a>8 定时器</h2><h3 id="8-1-简介"><a href="#8-1-简介" class="headerlink" title="8.1 简介"></a>8.1 简介</h3><h4 id="8-1-1-定时器资源"><a href="#8-1-1-定时器资源" class="headerlink" title="8.1.1 定时器资源"></a>8.1.1 定时器资源</h4><p>定时器介绍：51单片机的定时器属于单片机的内部资源，其电路的连接和运转均在单片机内部完成。</p>
<p>定时器作用：</p>
<ul>
<li>用于计时系统，可实现软件计时，或者使程序每隔一固定时间完成一项操作</li>
<li>替代长时间的Delay，提高CPU的运行效率和处理速度（不让CPU空转）</li>
</ul>
<p>定时器个数：3个（<code>T0</code>、<code>T1</code>、<code>T2</code>），T0和T1与传统的51单片机兼容，T2是此型号单片机增加的资源。</p>
<p>注意：定时器的资源和单片机的型号是关联在一起的，不同的型号可能会有不同的定时器个数和操作方式，但一般来说，T0和T1的操作方式是所有51单片机所共有的。</p>
<h4 id="8-1-2-框图"><a href="#8-1-2-框图" class="headerlink" title="8.1.2 框图"></a>8.1.2 框图</h4><p>定时器在单片机内部就像一个小闹钟一样，根据时钟的输出信号，每隔“一秒”，计数单元的数值就增加一，当计数单元数值增加到“设定的闹钟提醒时间”时，计数单元就会向中断系统发出<strong>中断申请</strong>，产生“响铃提醒”，使程序跳转到中断服务函数中执行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120143519757.png" alt="image-20221120143519757"></p>
<h4 id="8-1-3-工作模式"><a href="#8-1-3-工作模式" class="headerlink" title="8.1.3 工作模式"></a>8.1.3 工作模式</h4><p>STC89C52的<code>T0</code>和<code>T1</code>均有四种工作模式：    </p>
<ul>
<li>模式0：13位定时器/计数器    </li>
<li>模式1：<strong>16位定时器/计数器（常用）</strong>    </li>
<li>模式2：8位自动重装模式    </li>
<li>模式3：两个8位计数器</li>
</ul>
<blockquote>
<p>工作模式1的框图</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120144730109.png" alt="image-20221120144730109"></p>
<p><code>SYSclk</code>：系统时钟，即晶振周期，本开发板上的晶振为12MHz。然后可进行12分频和6分频两种，12分频使得时钟脉冲的频率变为1MHz（每1μs，计数加1），6分频使其变为2MHz。</p>
<p><code>T0 PIN</code>：计数器功能。<code>C/T非</code>是计数器（<code>Counter</code>）和定时器（<code>Timer</code>）的功能选择开关。若为低电平，则定时器功能选通，否则是计数器功能。</p>
<p>计数单元有两个字节寄存器组成，TL0表示低8位，TH0表示高8位，最大可表示的数为65535；当左侧时钟脉冲每过来一次，计数单元加1，直到最大值，使得标志位TF0为true，触发中断系统。</p>
<p>下方的<code>TR0</code>、<code>GATE</code>和<code>INT0</code>是控制位，控制定时器或计数器开启。</p>
<h4 id="8-1-4-中断系统"><a href="#8-1-4-中断系统" class="headerlink" title="8.1.4 中断系统"></a>8.1.4 中断系统</h4><p>中断系统是为使CPU具有对外界紧急事件的实时处理能力而设置的。</p>
<p>当中央处理机CPU正在处理某件事的时候外界发生了紧急事件请求，要求CPU暂停当前的工作，转而去处理这个紧急事件，处理完以后，再回到原来被中断的地方，继续原来的工作，这样的过程称为<strong>中断</strong>。实现这种功能的部件称为中断系统，<strong>请示CPU中断的请求源称为中断源</strong>。</p>
<p>微型机的中断系统一般允许多个中断源，当几个中断源同时向CPU请求中断，要求为它服务的时候，这就存在CPU优先响应哪一个中断源请求的问题。通常根据中断源的轻重缓急排队，优先处理最紧急事件的中断请求源，即规定每一个中断源有一个优先级别。CPU总是先响应优先级别最高的中断请求。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120150129912.png" alt="image-20221120150129912"></p>
<p>STC89C51RC/RD+系列单片机提供了8个中断请求源，它们分别是∶外部中断0（<code>INT0</code>）、定时器0中断、外部中断1（<code>INT1</code>）、定时器1中断、串口（<code>UART</code>）中断、定时器2中断、外部中断2（<code>INT2</code>）、外部中断3（<code>INT3</code>）。所有的中断都具有4个中断优先级。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120150315099.png" alt="image-20221120150315099"></p>
<p>注意：中断的资源和单片机的型号是关联在一起的，不同的型号可能会有不同的中断资源，例如中断源个数不同、中断优先级个数不同等等。</p>
<p>如果使用C语言编程，中断查询次序号就是中断号，例如：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120150330100.png" alt="image-20221120150330100"></p>
<h4 id="8-1-5-相关寄存器"><a href="#8-1-5-相关寄存器" class="headerlink" title="8.1.5 相关寄存器"></a>8.1.5 相关寄存器</h4><p>寄存器是连接软硬件的媒介。在单片机中寄存器就是一段特殊的<strong>RAM存储器</strong>（<code>特殊功能寄存器sfr</code>详见补充知识<code>1.4节存储</code>），一方面，寄存器可以存储和读取数据，另一方面，每一个寄存器背后都连接了一根导线，控制着电路的连接方式。寄存器相当于一个复杂机器的“操作按钮”。</p>
<blockquote>
<p>定时器/计数器相关寄存器</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120151001559.png" alt="image-20221120151001559"></p>
<blockquote>
<p>中断寄存器</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120150937221.png" alt="image-20221120150937221"></p>
<h5 id="①-TCON控制"><a href="#①-TCON控制" class="headerlink" title="① TCON控制"></a>① TCON控制</h5><p>对定时器T0或T1的控制寄存器：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120152554392.png" alt="image-20221120152554392"></p>
<ul>
<li>TF∶定时器/计数器溢出标志。T1被允许计数以后，从初值开始加1计数。当最高位产生溢出时由<strong>硬件置1</strong>，向CPU请求中断，一直保持到CPU响应中断时，才由硬件清0</li>
<li>TR：定时器的运行控制位。该位<strong>由软件置位和清零</strong>。当<code>GATE=0，TR1=1</code>时就允许T1开始计数，TR1=0时禁止T1计数。</li>
</ul>
<h5 id="②-TMOD模式"><a href="#②-TMOD模式" class="headerlink" title="② TMOD模式"></a>② TMOD模式</h5><p>定时和计数功能由特殊功能寄存器TMOD的控制位<code>C/T</code>进行选择，TMOD寄存器的各位信息如下表所列。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120153229129.png" alt="image-20221120153229129"></p>
<p>可以看出，2个定时/计数器有4种操作模式，通过TMOD的M1和M0选择。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120153747321.png" alt="image-20221120153747321"></p>
<h5 id="③-IE中断允许"><a href="#③-IE中断允许" class="headerlink" title="③ IE中断允许"></a>③ IE中断允许</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120153846419.png" alt="image-20221120153846419"></p>
<h3 id="8-2-LED间隔闪烁"><a href="#8-2-LED间隔闪烁" class="headerlink" title="8.2  LED间隔闪烁"></a>8.2  LED间隔闪烁</h3><p>效果：通过LED隔一秒闪烁一次。</p>
<blockquote>
<p>初始化定时器</p>
</blockquote>
<p>假设要让定时器0以模式1（16位定时）工作：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120161955762.png" alt="image-20221120161955762"></p>
<ul>
<li><code>TMOD</code><ul>
<li>GATE=0，C/T=0，M1=0，M0=1</li>
</ul>
</li>
<li><code>TCON</code><ul>
<li>初值计算：<code>0~65535</code>，每隔1μs计数加1，总共计时65535μs；64535距离计数器差值为1000，所以计时为1ms；</li>
<li>TH=64535/256，TL=64535%256；也可以使用工具生成定时器代码</li>
<li>TR0=1：允许T0开始计数</li>
</ul>
</li>
</ul>
<blockquote>
<p>初始化中断系统</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120162447931.png" alt="image-20221120162447931"></p>
<p>初始化值：ET0=1（T0溢出中断控制），EA=1（总中断控制），PT0=0（优先级设为最低级，也可以不设置，默认为0）</p>
<hr>
<blockquote>
<p>代码实现</p>
</blockquote>
<p>注：这里使用了<code>STC-ISP</code>的定时器计算器生成的代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120172000328.png" alt="image-20221120172000328"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Timer0Init</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;		<span class="comment">//1毫秒@12.000MHz</span></span><br><span class="line">	TMOD &amp;= <span class="number">0xF0</span>;		<span class="comment">//设置定时器模式</span></span><br><span class="line">	TMOD |= <span class="number">0x01</span>;		<span class="comment">//设置定时器模式</span></span><br><span class="line">	TL0 = <span class="number">0x18</span>;		<span class="comment">//设置定时初始值</span></span><br><span class="line">	TH0 = <span class="number">0xFC</span>;		<span class="comment">//设置定时初始值</span></span><br><span class="line">	TF0 = <span class="number">0</span>;		<span class="comment">//清除TF0标志</span></span><br><span class="line">	TR0 = <span class="number">1</span>;		<span class="comment">//定时器0开始计时</span></span><br><span class="line">	ET0 = <span class="number">1</span>; <span class="comment">// 打开定时器中断</span></span><br><span class="line">	EA = <span class="number">1</span>; <span class="comment">// 打开cpu总中断</span></span><br><span class="line">	PT0 = <span class="number">0</span>; <span class="comment">// 设置中断优先级</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Timer0Init();</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> T0Count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中断子程序</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Timer0_Routine</span><span class="params">()</span> interrupt 1 </span>&#123;</span><br><span class="line">	TL0 = <span class="number">0x18</span>;</span><br><span class="line">	TH0 = <span class="number">0xFC</span>;</span><br><span class="line">	T0Count++;</span><br><span class="line">	<span class="keyword">if</span>(T0Count &gt;= <span class="number">1000</span>) &#123;</span><br><span class="line">		T0Count = <span class="number">0</span>;</span><br><span class="line">		P2_0 =~ P2_0;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>第17行定时器初始化后开始计时，main程序进入while循环。</li>
<li>到达1ms时，定时器产生中断，cpu进入中断子程序，重新给定时器赋初值（让定时器以1ms定时），T0Count++（1000时就是1s）；</li>
<li>中断子程序执行完毕，又进入main程序继续执行（仍处于在while循环中）；</li>
<li>到达1ms时，定时器产生中断，cpu进入中断子程序，重新给定时器赋初值，T0Count++；</li>
<li>以此类推…（当T0Count=1000时，进入if语句，刷新T0Count，让LED灯状态取反）</li>
</ul>
<p>注意：在main函数的while循环里并未显式调用中断子程序，这一步是由定时器引起的中断让cpu自动做出的调用。</p>
<blockquote>
<p>代码改造——模块化</p>
</blockquote>
<ul>
<li><code>Timer0.c</code>和<code>Timer0.h</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Timer0Init</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;		<span class="comment">//1毫秒@12.000MHz</span></span><br><span class="line">	TMOD &amp;= <span class="number">0xF0</span>;		<span class="comment">//设置定时器模式</span></span><br><span class="line">	TMOD |= <span class="number">0x01</span>;		<span class="comment">//设置定时器模式</span></span><br><span class="line">	TL0 = <span class="number">0x18</span>;		<span class="comment">//设置定时初始值</span></span><br><span class="line">	TH0 = <span class="number">0xFC</span>;		<span class="comment">//设置定时初始值</span></span><br><span class="line">	TF0 = <span class="number">0</span>;		<span class="comment">//清除TF0标志</span></span><br><span class="line">	TR0 = <span class="number">1</span>;		<span class="comment">//定时器0开始计时</span></span><br><span class="line">	ET0 = <span class="number">1</span>; <span class="comment">// 打开定时器中断</span></span><br><span class="line">	EA = <span class="number">1</span>; <span class="comment">// 打开cpu总中断</span></span><br><span class="line">	PT0 = <span class="number">0</span>; <span class="comment">// 设置中断优先级</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __TIMER0_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __TIMER0_H__</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Timer0Init</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>main.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Timer0.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Timer0Init();</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中断子程序</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Timer0_Routine</span><span class="params">()</span> interrupt 1 </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> T0Count = <span class="number">0</span>;</span><br><span class="line">	TL0 = <span class="number">0x18</span>;</span><br><span class="line">	TH0 = <span class="number">0xFC</span>;</span><br><span class="line">	T0Count++;</span><br><span class="line">	<span class="keyword">if</span>(T0Count &gt;= <span class="number">1000</span>) &#123;</span><br><span class="line">		T0Count = <span class="number">0</span>;</span><br><span class="line">		P2_0 =~ P2_0;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：T0Count需要有<code>static</code>修饰，详见C语言学习笔记的<code>12.1.6 块作用域的静态变量（静态无链接）</code>。</p>
<h3 id="8-3-按键控制LED流水灯"><a href="#8-3-按键控制LED流水灯" class="headerlink" title="8.3 按键控制LED流水灯"></a>8.3 按键控制LED流水灯</h3><p>效果：通过按键控制LED流水灯的方向。</p>
<blockquote>
<p>代码实现</p>
</blockquote>
<ul>
<li><code>Key.c</code>和头文件</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">Key</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> keyNum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(P3_1==<span class="number">0</span>) &#123;Delay(<span class="number">20</span>); <span class="keyword">while</span>(P3_1==<span class="number">0</span>); Delay(<span class="number">20</span>); keyNum=<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span>(P3_1==<span class="number">0</span>) &#123;Delay(<span class="number">20</span>); <span class="keyword">while</span>(P3_1==<span class="number">0</span>); Delay(<span class="number">20</span>); keyNum=<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span>(P3_0==<span class="number">0</span>) &#123;Delay(<span class="number">20</span>); <span class="keyword">while</span>(P3_0==<span class="number">0</span>); Delay(<span class="number">20</span>); keyNum=<span class="number">2</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span>(P3_2==<span class="number">0</span>) &#123;Delay(<span class="number">20</span>); <span class="keyword">while</span>(P3_2==<span class="number">0</span>); Delay(<span class="number">20</span>); keyNum=<span class="number">3</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span>(P3_3==<span class="number">0</span>) &#123;Delay(<span class="number">20</span>); <span class="keyword">while</span>(P3_3==<span class="number">0</span>); Delay(<span class="number">20</span>); keyNum=<span class="number">4</span>;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> keyNum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __KEY_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __KEY_H__</span></span><br><span class="line">	<span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">Key</span><span class="params">()</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>作用：返回按下按键的序号</p>
<ul>
<li><code>main.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Timer0.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Key.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;INTRINS.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// LEDMode：流水灯模式；0左移，1右移</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> keyNum, LEDMode;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	P2 = <span class="number">0xFE</span>; <span class="comment">// 点亮最低位</span></span><br><span class="line">	Timer0Init();</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		keyNum = Key();</span><br><span class="line">		<span class="keyword">if</span>(keyNum) &#123;</span><br><span class="line">			<span class="keyword">if</span>(keyNum==<span class="number">1</span>) &#123;</span><br><span class="line">				LEDMode++;</span><br><span class="line">				<span class="keyword">if</span>(LEDMode&gt;=<span class="number">2</span>) LEDMode=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中断子程序</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Timer0_Routine</span><span class="params">()</span> interrupt 1 </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> T0Count = <span class="number">0</span>;</span><br><span class="line">	TL0 = <span class="number">0x18</span>;</span><br><span class="line">	TH0 = <span class="number">0xFC</span>;</span><br><span class="line">	T0Count++;</span><br><span class="line">	<span class="keyword">if</span>(T0Count &gt;= <span class="number">500</span>) &#123;</span><br><span class="line">		T0Count = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(LEDMode == <span class="number">0</span>) &#123;</span><br><span class="line">			P2 = _crol_(P2, <span class="number">1</span>); <span class="comment">// 向左循环移位</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(LEDMode == <span class="number">1</span>) &#123;</span><br><span class="line">			P2 = _cror_(P2, <span class="number">1</span>); <span class="comment">// 向右循环移位</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-4-定时器时钟"><a href="#8-4-定时器时钟" class="headerlink" title="8.4 定时器时钟"></a>8.4 定时器时钟</h3><p>效果：LCD显示屏1s递增</p>
<blockquote>
<p>代码实现</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Timer0.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LCD1602.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> Sec, Min, Hour;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	LCD_Init();</span><br><span class="line">	Timer0Init();</span><br><span class="line">	LCD_ShowString(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;CLOCK:&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		LCD_ShowNum(<span class="number">2</span>, <span class="number">1</span>, Hour, <span class="number">2</span>);</span><br><span class="line">		LCD_ShowString(<span class="number">2</span>, <span class="number">3</span>, <span class="string">&quot;:&quot;</span>);</span><br><span class="line">		LCD_ShowNum(<span class="number">2</span>, <span class="number">4</span>, Min, <span class="number">2</span>);</span><br><span class="line">		LCD_ShowString(<span class="number">2</span>, <span class="number">6</span>, <span class="string">&quot;:&quot;</span>);</span><br><span class="line">		LCD_ShowNum(<span class="number">2</span>, <span class="number">7</span>, Sec, <span class="number">2</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Timer0_Routine</span><span class="params">()</span> interrupt 1 </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> T0Count = <span class="number">0</span>;</span><br><span class="line">	TL0 = <span class="number">0x18</span>;</span><br><span class="line">	TH0 = <span class="number">0xFC</span>;</span><br><span class="line">	T0Count++;</span><br><span class="line">	<span class="keyword">if</span>(T0Count &gt;= <span class="number">1000</span>) &#123;</span><br><span class="line">		T0Count = <span class="number">0</span>;</span><br><span class="line">		Sec++;</span><br><span class="line">		<span class="keyword">if</span>(Sec == <span class="number">60</span>) &#123;</span><br><span class="line">			Sec = <span class="number">0</span>;</span><br><span class="line">			Min++;</span><br><span class="line">			<span class="keyword">if</span>(Min == <span class="number">60</span>) &#123;</span><br><span class="line">				Min = <span class="number">0</span>;</span><br><span class="line">				Hour++;</span><br><span class="line">				<span class="keyword">if</span>(Hour==<span class="number">24</span>) &#123;</span><br><span class="line">					Hour = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-串口通信"><a href="#9-串口通信" class="headerlink" title="9 串口通信"></a>9 串口通信</h2><h3 id="9-1-简介"><a href="#9-1-简介" class="headerlink" title="9.1 简介"></a>9.1 简介</h3><p>串口是一种应用十分广泛的通讯接口，串口成本低、容易使用、通信线路简单，可实现两个设备的互相通信。</p>
<p>单片机的串口可以使单片机与单片机、单片机与电脑、单片机与各式各样的模块互相通信，极大的扩展了单片机的应用范围，增强了单片机系统的硬件实力。</p>
<p>51单片机内部自带UART（<code>Universal Asynchronous Receiver Transmitter</code>，通用异步收发器），可实现单片机的串口通信。</p>
<blockquote>
<p>硬件电路</p>
</blockquote>
<ul>
<li>简单双向串口通信有两根通信线（发送端TXD和接收端RXD）</li>
<li>TXD与RXD要交叉连接</li>
<li>当只需单向的数据传输时，可以直接一根通信线</li>
<li>当电平标准不一致时，需要加电平转换芯片</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221121053910748.png" alt="image-20221121053910748"></p>
<blockquote>
<p>电平标准</p>
</blockquote>
<p><strong>电平标准是数据1和数据0的表达方式</strong>，是传输线缆中人为规定的电压与数据的对应关系，串口常用的电平标准有如下三种：</p>
<ul>
<li>TTL电平：+5V表示1，0V表示0</li>
<li>RS232电平：<code>-3~-15V</code>表示1，<code>+3~+15V</code>表示0</li>
<li>RS485电平：两线压差<code>+2~+6V</code>表示1，<code>-2~-6V</code>表示0（差分信号）</li>
</ul>
<blockquote>
<p>常用通信接口</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>引脚定义</strong></th>
<th><strong>通信方式</strong></th>
<th><strong>特点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>UART</td>
<td><code>TXD</code>、<code>RXD</code></td>
<td>全双工、异步</td>
<td>点对点通信</td>
</tr>
<tr>
<td>I²C</td>
<td>SCL、SDA</td>
<td>半双工、同步</td>
<td>可挂载多个设备</td>
</tr>
<tr>
<td>SPI</td>
<td>SCLK、MOSI、MISO、CS</td>
<td>全双工、同步</td>
<td>可挂载多个设备</td>
</tr>
<tr>
<td>1-Wire</td>
<td>DQ</td>
<td>半双工、异步</td>
<td>可挂载多个设备</td>
</tr>
</tbody>
</table>
</div>
<p>此外还有：CAN、USB等。</p>
<h3 id="9-2-单片机的UART"><a href="#9-2-单片机的UART" class="headerlink" title="9.2 单片机的UART"></a>9.2 单片机的UART</h3><h4 id="9-2-1-工作模式"><a href="#9-2-1-工作模式" class="headerlink" title="9.2.1 工作模式"></a>9.2.1 工作模式</h4><p>STC89C52有1个UART；</p>
<p>STC89C52的UART有四种工作模式：    </p>
<ul>
<li>模式0：同步移位寄存器    </li>
<li><strong>模式1：8位UART，波特率可变（常用）</strong>    </li>
<li>模式2：9位UART，波特率固定    </li>
<li>模式3：9位UART，波特率可变</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221121054656286.png" alt="image-20221121054656286"></p>
<h4 id="9-2-2-串口参数"><a href="#9-2-2-串口参数" class="headerlink" title="9.2.2 串口参数"></a>9.2.2 串口参数</h4><ul>
<li>波特率：串口通信的速率（发送和接收各数据位的间隔时间）</li>
<li>检验位：用于数据验证，对于9位数据格式，<code>RB8/TB8</code>为检验位</li>
<li>停止位：用于数据帧间隔</li>
</ul>
<p>先发低位，再发高位：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221121055114036.png" alt="image-20221121055114036"></p>
<h4 id="9-2-3-串口模式图"><a href="#9-2-3-串口模式图" class="headerlink" title="9.2.3 串口模式图"></a>9.2.3 串口模式图</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221121055403613.png" alt="image-20221121055403613"></p>
<ul>
<li>SBUF：串口数据缓存寄存器，<strong>物理上是两个独立的寄存器，但占用相同的地址</strong>。写操作时，写入的是发送寄存器，读操作时，读出的是接收寄存器。</li>
<li>T1溢出率（T1定时器）用来控制波特率。</li>
<li>最左侧的箭头为内部的总线。</li>
<li><code>SMOD</code>用于控制波特率是否加倍</li>
</ul>
<h4 id="9-2-4-串口和中断"><a href="#9-2-4-串口和中断" class="headerlink" title="9.2.4 串口和中断"></a>9.2.4 串口和中断</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221121055943122.png" alt="image-20221121055943122"></p>
<p>两个中断经过了或门，如果其中有一个中断了，就可通过或门输出1中断。</p>
<h4 id="9-2-5-相关寄存器"><a href="#9-2-5-相关寄存器" class="headerlink" title="9.2.5 相关寄存器"></a>9.2.5 相关寄存器</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221121060152417.png" alt="image-20221121060152417"></p>
<p>其中：<code>SCON</code>的<code>SM0</code>和<code>SM1</code>用于确定串口的工作方式：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221121060937682.png" alt="image-20221121060937682"></p>
<h3 id="9-3-串口向电脑发送数据"><a href="#9-3-串口向电脑发送数据" class="headerlink" title="9.3 串口向电脑发送数据"></a>9.3 串口向电脑发送数据</h3><p>效果：串口每秒向电脑发送按秒递增的数据。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221125113836091.png" alt="image-20221125113836091"></p>
<blockquote>
<p>代码实现</p>
</blockquote>
<ul>
<li>可以通过<code>STC-ISP</code>的波特率计算器来获取串口初始化代码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221125115137533.png" alt="image-20221125115137533"></p>
<ul>
<li>串口初始化和发送模块</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UART_Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 串口初始化</span></span><br><span class="line">	SCON = <span class="number">0x40</span>; <span class="comment">// 串口发送数据 0100 0000 工作在方式1</span></span><br><span class="line">	PCON |= <span class="number">0x80</span>; <span class="comment">// 1000 0000 波特率加倍</span></span><br><span class="line">	<span class="comment">// 时钟1初始化</span></span><br><span class="line">	TMOD &amp;= <span class="number">0x0F</span>;</span><br><span class="line">	TMOD |= <span class="number">0x20</span>;</span><br><span class="line">	TL1 = <span class="number">0xF4</span>;</span><br><span class="line">	TH1 = <span class="number">0xF4</span>;</span><br><span class="line">	TR1 = <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// 禁止定时器中断</span></span><br><span class="line">	ET1 = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UART_SendByte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Byte)</span></span>&#123;</span><br><span class="line">	<span class="comment">// 将发送数据写入SBUF中</span></span><br><span class="line">	SBUF = Byte;</span><br><span class="line">	<span class="comment">// 当缓冲满时，硬件将TI置为1并触发中断</span></span><br><span class="line">	<span class="keyword">while</span>(TI == <span class="number">0</span>);</span><br><span class="line">	<span class="comment">// 软件置为0</span></span><br><span class="line">	TI = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>TI</code>：发送中断请求标志位。在方式0，当串行发送数据第8位结束时，由<strong>内部硬件自动置位</strong>，即<code>TI=1</code>，向主机请求中断，<strong>响应中断后必须用软件复位</strong>，即<code>TI=0</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __UART_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __UART_H__</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">UART_Init</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">UART_SendByte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Byte)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>主函数</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;UART.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> Sec;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	UART_Init();</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		UART_SendByte(Sec);</span><br><span class="line">		Sec++;</span><br><span class="line">		Delay(<span class="number">1000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-4-电脑向串口发送数据"><a href="#9-4-电脑向串口发送数据" class="headerlink" title="9.4 电脑向串口发送数据"></a>9.4 电脑向串口发送数据</h3><ul>
<li><code>SCON</code>寄存器的第4位<code>REN</code>位：允许/禁止串行接收控制位。由软件置位REN，即<code>REN=1</code>为允许串行接收状态，可启动串行接收器RxD，开始接收信息。软件复位REN，即REN=0，则禁止接收。因此需要置为1；</li>
<li>启动串口中断<code>ES</code>：<code>ES=1</code></li>
<li>接收中断请求标志位：在方式0，当串行接收到第8位结束时由内部硬件自动置位<code>RI=1</code>，向主机请求中断，响应中断后<strong>必须用软件复位</strong>，即<code>RI=0</code>。在其他方式中，串行接收到停止位的中间时刻由内部硬件置位，即RI=1，<strong>必须由软件复位</strong>，即RI=0。</li>
</ul>
<blockquote>
<p>代码实现</p>
</blockquote>
<ul>
<li><code>UART.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UART_Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 串口初始化</span></span><br><span class="line">	SCON = <span class="number">0x50</span>; <span class="comment">// 接收使能</span></span><br><span class="line">	PCON |= <span class="number">0x80</span>;</span><br><span class="line">	<span class="comment">// 时钟1初始化</span></span><br><span class="line">	TMOD &amp;= <span class="number">0x0F</span>;</span><br><span class="line">	TMOD |= <span class="number">0x20</span>;</span><br><span class="line">	TL1 = <span class="number">0xF4</span>;</span><br><span class="line">	TH1 = <span class="number">0xF4</span>;</span><br><span class="line">	TR1 = <span class="number">1</span>;</span><br><span class="line">	ET1 = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// 打开总中断</span></span><br><span class="line">	EA = <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// 打开串口中断</span></span><br><span class="line">	ES = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UART_SendByte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Byte)</span></span>&#123;</span><br><span class="line">	<span class="comment">// 将发送数据写入SBUF中</span></span><br><span class="line">	SBUF = Byte;</span><br><span class="line">	<span class="comment">// 当缓冲满时，硬件将TI置为1并触发中断</span></span><br><span class="line">	<span class="keyword">while</span>(TI == <span class="number">0</span>);</span><br><span class="line">	<span class="comment">// 软件置为0</span></span><br><span class="line">	TI = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>main.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;UART.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	UART_Init();</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中断子程序</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UART_Routine</span><span class="params">()</span> interrupt 4 </span>&#123;</span><br><span class="line">	<span class="comment">// 当接收中断时</span></span><br><span class="line">	<span class="keyword">if</span>(RI == <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="comment">// 将SBUF的数据写入P2</span></span><br><span class="line">		P2 = ~SBUF;</span><br><span class="line">		<span class="comment">// 将电脑的数据又发回电脑</span></span><br><span class="line">		UART_SendByte(SBUF);</span><br><span class="line">		<span class="comment">// 软件复位</span></span><br><span class="line">		RI = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-5-波特率计算"><a href="#9-5-波特率计算" class="headerlink" title="9.5 波特率计算"></a>9.5 波特率计算</h3><p>定时器1的初始值为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TL1 = <span class="number">0xF4</span>;</span><br><span class="line">TH1 = <span class="number">0xF4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 换算为十进制：</span></span><br><span class="line">TL1 = <span class="number">244</span>;</span><br><span class="line">TH1 = <span class="number">244</span>;</span><br></pre></td></tr></table></figure>
<p>则计数<code>256 - 244 = 12</code>个数就溢出一次（配置的是定时器1的<strong>8位自动重装</strong>，因此到达8位最大值256时就溢出）；</p>
<p>对于<code>11.0592MHz</code>的晶振，设定在<code>12T</code>的模式下（12分频）时，实际的晶振频率为<code>0.9216MHz</code>，所以计数1次需要<code>1/0.9216μs</code>（MHz对应μs），大约为<code>1.085069444444444μs</code>，则计数12次为<code>13.02083333333333μs</code>，对应的溢出频率为<code>0.0768MHz</code>；</p>
<p>如果设置了波特率加倍（<code>SMOD=1</code>，即没有除以2），则T1溢出率（<code>0.0768MHz</code>）到达发送/接收控制器的频率为<code>0.0768MHz/16=0.0048MHz</code>，即<code>4800Hz</code>，即为波特率。</p>
<h2 id="10-LED点阵屏"><a href="#10-LED点阵屏" class="headerlink" title="10 LED点阵屏"></a>10 LED点阵屏</h2><h3 id="10-1-简介"><a href="#10-1-简介" class="headerlink" title="10.1 简介"></a>10.1 简介</h3><p>LED点阵屏由若干个独立的LED组成，LED以矩阵的形式排列，以灯珠亮灭来显示文字、图片、视频等。LED点阵屏广泛应用于各种公共场合，如汽车报站器、广告屏以及公告牌等。</p>
<p>LED点阵屏分类：</p>
<ul>
<li>按颜色：单色、双色、全彩    </li>
<li>按像素：<code>8*8</code>、<code>16*16</code>等（大规模的LED点阵通常由很多个小点阵拼接而成）</li>
</ul>
<blockquote>
<p>显示原理</p>
</blockquote>
<ul>
<li>单色LED点阵</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221125134347451.png" alt="image-20221125134347451"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221125134341203.png" alt="image-20221125134341203"></p>
<ul>
<li>双色LED点阵</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221125134403629.png" alt="image-20221125134403629"></p>
<p>LED点阵屏的结构类似于数码管，只不过是数码管把每一列的像素以“8”字型排列而已；</p>
<p>LED点阵屏与数码管一样，有共阴和共阳两种接法，不同的接法对应的电路结构不同；</p>
<p>LED点阵屏需要进行<strong>逐行或逐列扫描</strong>，才能使所有LED同时显示；</p>
<blockquote>
<p>电路图</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221125135400916.png" alt="image-20221125135400916"></p>
<ul>
<li><code>DPa~DPh</code>选择的是从下到上的行</li>
<li><code>P00~P07</code>选择的是从右到左的列</li>
</ul>
<blockquote>
<p><code>74HC595</code></p>
</blockquote>
<p>74HC595是<strong>串行输入并行输出</strong>的移位寄存器（串转并），可用3根线输入串行数据，8根线输出并行数据，多片级联后，可输出16位、24位、32位等，常用于IO口扩展。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221125141328039.png" alt="image-20221125141328039"></p>
<ul>
<li><code>OE非</code>：74HC595芯片使能端，非表示低电平使能，因此需要将J24跳线帽接在2和3号位，让OE端接地使能；</li>
<li><code>RCLK</code>：上升沿锁存，接P35口；P35口由0转1（上升沿）时，将串行输入缓存送至并行输出端（QA至QH口）；</li>
<li><code>SRCLK</code>：上升沿移位，接P36口；P36口由0转1（上升沿）时，将输入进行移位；</li>
<li><code>SER</code>：串行输入口，接P34口</li>
<li><code>QA~QH</code>：并行输出口</li>
<li><code>QH&#39;</code>：用于多片级联，接在下一片<code>74HC595</code>的串行输入口<code>SER</code>上</li>
</ul>
<p>芯片内部图如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221125141806205.png" alt="image-20221125141806205"></p>
<h3 id="10-2-点阵显示图形"><a href="#10-2-点阵显示图形" class="headerlink" title="10.2 点阵显示图形"></a>10.2 点阵显示图形</h3><p> 效果：在LED点阵屏上显示对角线</p>
<blockquote>
<p>代码实现</p>
</blockquote>
<ul>
<li><code>MatrixLED</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __MATRIXLED_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __MATRIXLED_H__</span></span><br><span class="line"></span><br><span class="line">	sbit RCK = <span class="number">0xB5</span>; <span class="comment">// 上升沿锁存</span></span><br><span class="line">	sbit SCK = <span class="number">0xB6</span>; <span class="comment">// 上升沿移位</span></span><br><span class="line">	sbit SER = <span class="number">0xB4</span>; <span class="comment">// 串行输入</span></span><br><span class="line">	<span class="keyword">void</span> _74HC595_WriteByte(<span class="keyword">unsigned</span> <span class="keyword">char</span> byte);</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">MatrixLED_ShowColumn</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Col, Data)</span></span>;</span><br><span class="line">	</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;MatrixLED.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _74HC595_WriteByte(<span class="keyword">unsigned</span> <span class="keyword">char</span> byte) &#123;</span><br><span class="line">	<span class="comment">// 这里左侧SER是1位寄存器，右侧是一个8位数据</span></span><br><span class="line">	<span class="comment">// 8位赋值给1位的规则是：非零即1</span></span><br><span class="line">	<span class="comment">// 假设取出byte的第8位</span></span><br><span class="line">	<span class="comment">// 如果第8位是1，则与后的结果为1000 0000，非零，则SER=1</span></span><br><span class="line">	<span class="comment">// 如果第8位是0，则与后的结果为0000 0000，则SER=0</span></span><br><span class="line">	<span class="comment">// 与操作起到了掩码的作用</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i =<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">		SER = byte&amp;(<span class="number">0x80</span> &gt;&gt; i);</span><br><span class="line">		<span class="comment">// 给一个上升沿进行移位</span></span><br><span class="line">		SCK = <span class="number">1</span>;</span><br><span class="line">		<span class="comment">// 复位</span></span><br><span class="line">		SCK = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 给一个上升沿进行锁存输出</span></span><br><span class="line">	RCK = <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// 复位</span></span><br><span class="line">	RCK = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Col: 74HC595选中的列</span></span><br><span class="line"><span class="comment">// Data：控制LED亮灭的数据</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MatrixLED_ShowColumn</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> Col, Data)</span> </span>&#123;</span><br><span class="line">	_74HC595_WriteByte(Data);</span><br><span class="line">	P0 = ~(<span class="number">0x80</span>&gt;&gt;Col);</span><br><span class="line">	<span class="comment">// 延时和消影</span></span><br><span class="line">	Delay(<span class="number">1</span>);</span><br><span class="line">	P0 = <span class="number">0xFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>main</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;MatrixLED.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 复位</span></span><br><span class="line">	SCK = <span class="number">0</span>;</span><br><span class="line">	RCK = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// 死循环不断扫描</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		MatrixLED_ShowColumn(<span class="number">0</span>, <span class="number">0x80</span>);</span><br><span class="line">		MatrixLED_ShowColumn(<span class="number">1</span>, <span class="number">0x40</span>);</span><br><span class="line">		MatrixLED_ShowColumn(<span class="number">2</span>, <span class="number">0x20</span>);</span><br><span class="line">		MatrixLED_ShowColumn(<span class="number">3</span>, <span class="number">0x10</span>);</span><br><span class="line">		MatrixLED_ShowColumn(<span class="number">4</span>, <span class="number">0x08</span>);</span><br><span class="line">		MatrixLED_ShowColumn(<span class="number">5</span>, <span class="number">0x04</span>);</span><br><span class="line">		MatrixLED_ShowColumn(<span class="number">6</span>, <span class="number">0x02</span>);</span><br><span class="line">		MatrixLED_ShowColumn(<span class="number">7</span>, <span class="number">0x01</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="11-实时时钟"><a href="#11-实时时钟" class="headerlink" title="11 实时时钟"></a>11 实时时钟</h2><h3 id="11-1-简介"><a href="#11-1-简介" class="headerlink" title="11.1 简介"></a>11.1 简介</h3><h2 id="12-蜂鸣器"><a href="#12-蜂鸣器" class="headerlink" title="12 蜂鸣器"></a>12 蜂鸣器</h2><h3 id="12-1-简介"><a href="#12-1-简介" class="headerlink" title="12.1 简介"></a>12.1 简介</h3><p>蜂鸣器是一种将电信号转换为声音信号的器件，常用来产生设备的按键音、报警音等提示信号。</p>
<p>蜂鸣器按驱动方式可分为有源蜂鸣器和无源蜂鸣器</p>
<ul>
<li>有源蜂鸣器：内部自带振荡源，将正负极接上直流电压即可持续发声，频率<strong>固定</strong></li>
<li>无源蜂鸣器：内部不带振荡源，需要控制器提供振荡脉冲才可发声，调整提供振荡脉冲的频率，<strong>可发出不同频率的声音</strong></li>
</ul>
<p>一般的，蜂鸣器电路图表示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img21/image-20221231195653736.png" alt="image-20221231195653736"></p>
<h3 id="12-2-驱动电路"><a href="#12-2-驱动电路" class="headerlink" title="12.2 驱动电路"></a>12.2 驱动电路</h3><ul>
<li>三极管驱动</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img21/image-20221231200608160.png" alt="image-20221231200608160"></p>
<p>例如上图中，通过NPN型三极管Q1进行驱动。当基极接高电平时，三极管导通，此时蜂鸣器工作，反之不工作。</p>
<ul>
<li>集成电路驱动</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img21/image-20221231201026822.png" alt="image-20221231201026822"></p>
<p>上图，蜂鸣器负极引出引脚为<code>BEEP</code>，该引脚接至<code>ULN2003</code>芯片的12号引脚，如下图所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img21/image-20221231201137354.png" alt="image-20221231201137354"></p>
<p>其中<code>ULN2003</code>是一个单片高电压、高电流的达林顿晶体管阵列集成电路，主要用于继电器驱动器、字锤驱动器、灯驱动器、显示驱动器、线路驱动器和逻辑缓冲器。</p>
<p>由上图可知，通过<code>P25</code>IO口取反控制<code>OUT5</code>的输出，进而控制蜂鸣器的工作状态，即<code>P25</code>口输入1，取反为0输出到<code>OUT5</code>，使得蜂鸣器工作，输入0则不工作。</p>
<h3 id="12-3-音符和频率"><a href="#12-3-音符和频率" class="headerlink" title="12.3 音符和频率"></a>12.3 音符和频率</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img21/image-20230101101735904.png" alt="image-20230101101735904"></p>
<h3 id="12-4-蜂鸣器播放提示音"><a href="#12-4-蜂鸣器播放提示音" class="headerlink" title="12.4 蜂鸣器播放提示音"></a>12.4 蜂鸣器播放提示音</h3><p>效果：按下独立按键，蜂鸣器播放提示音。</p>
<blockquote>
<p>代码实现</p>
</blockquote>
<ul>
<li><code>Buzzer.h</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __BUZZER_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __BUZZER_H__</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Buzzer_Time</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> ms)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>Buzzer.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">sbit Buzzer = P2^<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Buzzer_Time</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> ms)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; ms; i++) &#123;</span><br><span class="line">		Buzzer = !Buzzer;</span><br><span class="line">		Delay(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>main.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;REGX52.H&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Key.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Nixie.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Buzzer.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> KeyNum;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Nixie(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		KeyNum = Key();</span><br><span class="line">		<span class="keyword">if</span>(KeyNum) &#123;</span><br><span class="line">			Buzzer_Time(<span class="number">1000</span>);</span><br><span class="line">			Nixie(<span class="number">1</span>, KeyNum);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-5-蜂鸣器播放音乐"><a href="#12-5-蜂鸣器播放音乐" class="headerlink" title="12.5 蜂鸣器播放音乐"></a>12.5 蜂鸣器播放音乐</h3><h2 id="13-AT24C02-I2C"><a href="#13-AT24C02-I2C" class="headerlink" title="13 AT24C02(I2C)"></a>13 AT24C02(I2C)</h2><h2 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h2><h3 id="1-单片机原理（基础）"><a href="#1-单片机原理（基础）" class="headerlink" title="1 单片机原理（基础）"></a>1 单片机原理（基础）</h3><p>主要参考资料：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1x94y1D7hm/">电光耗子皮卡皮</a></p>
<h4 id="1-1-单片机的三大发展阶段"><a href="#1-1-单片机的三大发展阶段" class="headerlink" title="1.1 单片机的三大发展阶段"></a>1.1 单片机的三大发展阶段</h4><ul>
<li>SCM：（<code>Single Chip Micro computer</code>），单片微型计算机阶段。寻求最佳单片状态的嵌入式体系结构。最具代表性的产品是Intel的8位<code>MCS-51</code>系列单片机。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117195828104.png" alt="image-20221117195828104"></p>
<ul>
<li>MCU：（<code>Micro Controller Unit</code>），微控制器阶段。集成各种外围电路与接口电路的能力。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117195835031.png" alt="image-20221117195835031"></p>
<ul>
<li>SOC：（<code>System on Chip</code>），SoC是一个有专用目标的集成电路，包含完整系统并嵌入软件的全部内容。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117195842252.png" alt="image-20221117195842252"></p>
<h4 id="1-2-基础框架结构"><a href="#1-2-基础框架结构" class="headerlink" title="1.2 基础框架结构"></a>1.2 基础框架结构</h4><p>以<code>MCS-51</code>为例。</p>
<p>SCM：将通用微计算机基本功能部件集成在一块芯片上构成的一种专用微机系统。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117200548494.png" alt="image-20221117200548494"></p>
<p><code>SCM = CPU+OSC+ROM+RAM+I/O+INTERRUPT+TIME/COUNTER+UART+BUS EXTENDER</code></p>
<ul>
<li>1个8位中央处理器<code>CPU</code></li>
<li>4KB片内<strong>程序存储器</strong><code>ROM</code>，相当于计算机的硬盘</li>
<li>256字节<strong>数据存储器</strong><code>RAM</code>，相当于计算机的内存</li>
<li>4个8位并行<code>I/O</code>口</li>
<li>5个中断源<code>INT</code></li>
<li>2个16位定时器/计数器<code>T/C</code></li>
<li>1个全双工串行口<code>UART</code></li>
<li>可扩展64KB ROM和RAM 的总线</li>
</ul>
<h4 id="1-3-CPU"><a href="#1-3-CPU" class="headerlink" title="1.3 CPU"></a>1.3 CPU</h4><p>CPU是单片机的核心。CPU（中央处理器）分为控制器和运算器两部分。</p>
<h5 id="1-3-1-控制器"><a href="#1-3-1-控制器" class="headerlink" title="1.3.1 控制器"></a>1.3.1 控制器</h5><ul>
<li>控制器的用途:统一指挥和控制各单元协调工作</li>
<li>控制器的任务: 从ROM中取出指令—-&gt;译码—-&gt;执行指令</li>
<li>控制器的组成：<ul>
<li>程序计数器(Program Counter - <code>PC</code>) : 指向下一条指令的首地址，ROM存储单元的地址指针(引导程序运行)，可修改，让程序跳转运行复位时:<code>PC初值=0 --&gt; 复位后程序从0开始运行</code>。</li>
<li>指令寄存器(nstruction Register - <code>IR</code>) : 8位寄存器，暂存指令，等待译码</li>
<li>指令译码器(Instruction Decoder - <code>ID</code>) : 将指令寄存器的指令进行译码，转为可执行的电信号再通过定时器电路将其执行</li>
<li>数据指针寄存器 (Data Pointer -<code>DPTR</code>) : 指向ROM或RAM存储单元的地址指针(引导数据传送)，DPTR是专门为16位(或者小于16位)的外部RAM或者外部ROM准备用于读取和写入的。</li>
</ul>
</li>
</ul>
<h5 id="1-3-2-运算器"><a href="#1-3-2-运算器" class="headerlink" title="1.3.2 运算器"></a>1.3.2 运算器</h5><p>略</p>
<h4 id="1-4-存储"><a href="#1-4-存储" class="headerlink" title="1.4 存储"></a>1.4 存储</h4><h5 id="1-4-1-存储空间"><a href="#1-4-1-存储空间" class="headerlink" title="1.4.1 存储空间"></a>1.4.1 存储空间</h5><ul>
<li>普林斯顿结构：RAM和ROM统一编址</li>
<li>哈佛结构：<strong>RAM和ROM独立编址</strong>，51单片机采用哈佛结构。</li>
</ul>
<p>因此单片机共有4个物理存储空间：片内RAM，片内ROM，片外RAM和片外ROM，3个逻辑存储空间：片内片外ROM统一编址。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117201852382.png" alt="image-20221117201852382"></p>
<h5 id="1-4-2-程序存储器ROM"><a href="#1-4-2-程序存储器ROM" class="headerlink" title="1.4.2 程序存储器ROM"></a>1.4.2 程序存储器ROM</h5><p>作用：存放程序，表格或常数，掉电不丢失。</p>
<ul>
<li>EA = 1时，4 KB以内的地址在片内ROM，大于4KB的地址在片外ROM中 (图中折线)，两者共同构成64KB空间。</li>
<li>EA = 0时，片内ROM被禁用，全部64KB地址都在片外ROM中 (图中直线)</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117202214977.png" alt="image-20221117202214977"></p>
<h5 id="1-4-3-数据存储器RAM"><a href="#1-4-3-数据存储器RAM" class="headerlink" title="1.4.3 数据存储器RAM"></a>1.4.3 数据存储器RAM</h5><blockquote>
<p>地址</p>
</blockquote>
<p>在单片机、计算机系统里面，内存为了定位(为了能够找到每一个内存空间)，把每一个空间都编上一个序号，那么内存编号的那个号码我们就叫<strong>地址</strong>，地址编号通常以十六进制的数字表示。</p>
<p>存储器系统中，给字节编号就叫字节地址，给二进制位编号就叫位地址。</p>
<hr>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117202937409.png" alt="image-20221117202937409"></p>
<ul>
<li><p>①区：共有32个字节地址：<code>00H ~ 1FH</code>，每个字节地址都有一个寄存器名称（<code>R0 ~ R7</code>），32个字节地址被分为4组（第0~第3组）；CPU在一个时刻，只能选一组<strong>工作寄存器组</strong>，通过程序状态字寄存器<code>PSW</code>的<code>RS1</code>和<code>RS0</code>来控制选组，不设置的话默认选择第0组，剩下的三组则用作<strong>数据存储器</strong>。</p>
</li>
<li><p>②区：共有16个字节地址：<code>20H ~ 2FH</code>，合计<code>16 * 8 = 128</code>个位地址，可以用字节地址或位地址进行寻址。</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117203628428.png" alt="image-20221117203628428"></p>
<ul>
<li><p>③区：共有80个字节地址，没有位地址，也没有寄存器名称，此区可作为堆栈区和中间数据存储区使用。</p>
</li>
<li><p>特殊功能寄存器区<code>SFR</code>：<code>Special Function Register</code>，承担着单片机内部资源的管理工作。</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117204222068.png" alt="image-20221117204222068"></p>
<blockquote>
<p>示例</p>
</blockquote>
<p>直接寻址：通过把地址定义一个名称后，修改在该地址的内存空间的内容。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Sbit P0_0 = <span class="number">80</span>H; <span class="comment">// 把80H编号的位空间取一个名称P0_0，定义一个名称P0_0</span></span><br><span class="line">P0_0 = <span class="number">1</span>; <span class="comment">// 把1赋值给P0_0，即赋值给80H位空间</span></span><br><span class="line"><span class="comment">//---------------</span></span><br><span class="line">Sfr P0 = <span class="number">80</span>H; <span class="comment">// 把80H编号的字节空间去一个名称P0</span></span><br><span class="line">P0 = <span class="number">10010101b</span>; <span class="comment">// 赋值</span></span><br></pre></td></tr></table></figure>
<p><code>Sfr</code>：特殊寄存器字节定义指令</p>
<p><code>Sbit</code>：位地址定义指令</p>
<h4 id="1-5-单片机引脚"><a href="#1-5-单片机引脚" class="headerlink" title="1.5 单片机引脚"></a>1.5 单片机引脚</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117204915019.png" alt="image-20221117204915019"></p>
<ul>
<li><code>P1.0 ~ P1.7</code>：1-8脚，准双向IO口，P1端口</li>
<li><code>P3.0 ~ P3.7</code>：10-17脚，带复用功能，P3端口</li>
<li><code>P2.0 ~ P2.7</code>：21-28脚，高八位数据总线，P2端口</li>
<li><code>P0.0 ~ P0.7</code>：39-32脚，低八位数据总线，P0端口</li>
</ul>
<blockquote>
<p>引脚分类</p>
</blockquote>
<ul>
<li>电源及晶振引脚（4）</li>
<li>控制引脚（4）</li>
<li>端口引脚（32）</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117205038651.png" alt="image-20221117205038651"></p>
<h4 id="1-6-IO口"><a href="#1-6-IO口" class="headerlink" title="1.6 IO口"></a>1.6 IO口</h4><h5 id="1-6-1-基本元器件"><a href="#1-6-1-基本元器件" class="headerlink" title="1.6.1 基本元器件"></a>1.6.1 基本元器件</h5><h6 id="①-二极管"><a href="#①-二极管" class="headerlink" title="① 二极管"></a>① 二极管</h6><p>具有单向导电性能， 即给二极管阳极加上正向电压时，二极管导通。 当给阳极和阴极加上反向电压时，二极管截止。 因此，二极管的导通和截止，则相当于开关的接通与断开。二极管就是由一个<strong>PN结</strong>加上相应的电极引线及管壳封装而成的。</p>
<ul>
<li>N型半导体：硅原子外层带4个负电子，多个硅原子连接，外层形成稳定的8电子结构，因此纯净的硅晶体不导电。为了能使其导电，在硅晶体中掺杂了磷原子，磷原子多余的一个电子成为自由电子，使其能够导电。因为自由电子带负电，因此称为N型半导体，即<code>Negative</code>。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118144029673.png" alt="image-20221118144029673"></p>
<ul>
<li>P型半导体：在硅晶体中掺杂硼原子，硼原子周围缺少一个电子，形成空穴，吸引负电子，对外显正电，因此称为P型半导体，即<code>Postive</code>。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118144248890.png" alt="image-20221118144248890"></p>
<ul>
<li>PN结：采用不同的掺杂工艺，通过扩散作用，将<strong>P型半导体与N型半导体</strong>制作在同一块半导体（通常是硅或锗）基片上，在它们的交界面就形成空间电荷区称为PN结。</li>
<li>由P区引出的电极称为阳极，N区引出的电极称为阴极。因为PN结的单向导电性，二极管导通时电流方向是由阳极通过管子内部流向阴极。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117212032346.png" alt="image-20221117212032346"></p>
<p>电场方向和电子的受力方向相反：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118144451523.png" alt="image-20221118144451523" style="zoom:50%;" /></p>
<p>当正极接P端时，自由电子可以和空穴复合，形成电流。反之则不行。<strong>正（电源正极）接正（P端Positive），负接负</strong>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118144728861.png" alt="image-20221118144728861" style="zoom:50%;" /></p>
<h6 id="②-三极管"><a href="#②-三极管" class="headerlink" title="② 三极管"></a>② 三极管</h6><p>用电控制的开关分为三极管和mos管，实际上后两者的功能不仅限于电路的开闭，还有放大等作用。</p>
<p>三极管：通过电流控制电路开闭</p>
<ul>
<li>NPN：NPN型三极管是指由两块N型半导体中间夹着一块P型半导体所组成的三极管。可以看成两个二极管的P端连接在一起。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118144922412.png" alt="image-20221118144922412"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117212251657.png" alt="image-20221117212251657"></p>
<p>三极管由两个PN结构成，共用的一个电极成为三极管的<strong>基极</strong>(用字母B表示——B取自英文Base)，其他的两个电极分别称为<strong>集电极</strong>(用字母C表示——C取自英文Collector，收集)和<strong>有箭头的发射极</strong>(用字母E表示—— E取自英文Emitter，发射)。基区和发射区之间的结成为发射结，基区和集电区之间的结成为集电结。</p>
<p>集电区掺杂浓度（自由电子数量多）最高，发射区次之，基区（空穴数量较少）最低且最薄。</p>
<p>不论将电源接至集电极或发射极，三极管均不能导通。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118145237849.png" alt="image-20221118145237849" style="zoom:50%;" /></p>
<p>如果给BE极也加上电源（正接正，负接负）：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118145804811.png" alt="image-20221118145804811" style="zoom:50%;" /></p>
<p>发射区的电子向基区的空穴复合，但是只有少部分能够复合成功，形成基极电流<code>B-&gt;E</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118150238629.png" alt="image-20221118150238629" style="zoom:50%;" /></p>
<p>而大部分负电子被吸引到了集电区，形成集电极电流<code>C-&gt;E</code>，也就是三极管的输出电流。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118150312775.png" alt="image-20221118150312775" style="zoom:50%;" /></p>
<p>基区做得很薄，是为了让发射区的电子更容易进入集电区。</p>
<p>功能：用 B-E 的电流 (IB) 控制 C-E 的电流 (IC)，如果B-E没有电流，则C-E断；如果B接高，则B-E有电流，C-E通。</p>
<ul>
<li>PNP：用 E-B 的电流 (IB) 控制 E-C 的电流(IC)，E极电位最高，且正常放大时通常C极电位最低，即VC&lt;VB&lt;VE；如果B接低，则通。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117212904578.png" alt="image-20221117212904578"></p>
<h6 id="③-mos管"><a href="#③-mos管" class="headerlink" title="③ mos管"></a>③ mos管</h6><p>mos管：通过电压控制电路开闭。全称金属氧化物半导体场效应晶体管（<code>Metal Oxide Semiconductor Field Effect Transistor</code>），简写为MOSFET，再次简写为MOS。</p>
<ul>
<li>N沟道mos管：由NPN构成，给两块N型半导体引出两个金属电极，分别作为mos管的漏极和源极。如果像下面这样直接连接并不会导通，因为NPN实际上构成了两个方向相反的二极管。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118151507156.png" alt="image-20221118151507156"></p>
<p>电路符号：图中箭头的方向是N沟道电子的流动方向。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118151611529.png" alt="image-20221118151611529"></p>
<p>为了让其导通，在P区添加了一层很薄的二氧化硅绝缘层，上覆盖一个金属板，形成<strong>栅极</strong>。给栅极也接上电（正极），栅极就会排斥空穴，吸引电子。电压越大，吸引的电子就越多，直到累计到一定数量时，在两个N型半导体之间形成了<strong>N沟道</strong>。此时可以将其看成一整块N型半导体。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118152434502.png" alt="image-20221118152434502"></p>
<p>mos管特性：</p>
<ol>
<li>栅极的输入阻抗非常高，因为有红色的绝缘层的存在，造成其输入电阻可达上亿欧姆。所以它的输入几乎不取电流。</li>
<li>栅极容易被静电击穿</li>
</ol>
<p>总结：漏极D接正极，源极S接负极，栅极<strong>G正电压</strong>时，导电沟道建立</p>
<ul>
<li>P沟道mos管：漏极D接负极，源极S接正极，栅极<strong>G负电压</strong>时，导电沟道建立</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117213559641.png" alt="image-20221117213559641"></p>
<p>口诀：<strong>P下N上</strong>：NPN和Nmos，通过高电位导通；PNP和Pmos通过低电位导通</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117211502628.png" alt="image-20221117211502628"></p>
<h6 id="④-三态门"><a href="#④-三态门" class="headerlink" title="④ 三态门"></a>④ 三态门</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117214204825.png" alt="image-20221117214204825"></p>
<p>E接高电平导通，相当于NPN型的三极管。<strong>N上</strong></p>
<h6 id="⑤-触发器"><a href="#⑤-触发器" class="headerlink" title="⑤ 触发器"></a>⑤ 触发器</h6><p>触发器具有记忆存储功能，由门电路组成。这里简单介绍D触发器。</p>
<ul>
<li>正边沿D触发器<ul>
<li>D：输入；Q输出；CLK：时钟脉冲</li>
<li>只有在时钟脉冲CLK<strong>上升沿</strong>到来的时刻，才采样D端的输入信号，来改变Q的输出状态，而在其他时刻，D和Q是隔离的。</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117214641356.png" alt="image-20221117214641356"></p>
<ul>
<li>负边沿D触发器：</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221117214659602.png" alt="image-20221117214659602"></p>
<p>D触发器广泛用于数字信号的<strong>锁存输出</strong>。</p>
<h5 id="1-6-2-拉电流和灌电流"><a href="#1-6-2-拉电流和灌电流" class="headerlink" title="1.6.2 拉电流和灌电流"></a>1.6.2 拉电流和灌电流</h5><p>拉电流和灌电流是衡量电路输出驱动能力（注意：拉、灌都是对<strong>芯片输出端</strong>而言的，所以是驱动能力）的参数。</p>
<p>由于数字电路的输出只有高、低（0，1）两种电平值，高电平输出时，一般是输出端对负载<strong>提供</strong>电流，其提供电流的数值叫“拉电流”；</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118163354353.png" alt="image-20221118163354353"></p>
<p>低电平输出时，一般是输出端要<strong>吸收</strong>负载的电流，其吸收电流的数值叫“灌（入）电流”。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118163447989.png" alt="image-20221118163447989"></p>
<p>对于大多数的逻辑电路（数字电路和单片机），输出拉电流的能力较弱，一般只有几毫安（<code>&lt;5mA</code>），而输出灌电流的能力较强，一般为<code>5~10mA</code>。</p>
<p>一般情况下，在需要一定电流驱动的情况下，通常将驱动负载使用“灌电流”比较合适（例如LED），对于只是提供“开关信号”或者基本不需要电流驱动的情况下，使用“拉电流”比较合适。</p>
<h5 id="1-6-3-上拉和下拉"><a href="#1-6-3-上拉和下拉" class="headerlink" title="1.6.3 上拉和下拉"></a>1.6.3 上拉和下拉</h5><p>上拉电阻和下拉电阻：上拉电阻和下拉电阻都是电阻元器件，所谓<strong>上拉电阻就是接电源正极</strong>，<strong>下拉的就是接负极或地</strong>。</p>
<p>上拉就是将不确定的信号通过一个电阻钳位在高电平，上拉电阻其实和上拉电压并没有太大关系，它的主要作用是补全电路，起<strong>限流和负载</strong>的作用。</p>
<p>下拉同理，也是将不确定的信号通过一个电阻钳位在低电平。</p>
<blockquote>
<p>上拉电阻解析</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221119110256333.png" alt="image-20221119110256333"></p>
<p>如上图所示，当上拉电阻位于单片机内部时。若B没有电流，则三极管断开，IO输出位高电平（该端口没有接负载，为开路电压；或者没有电流，压降为0）；若B有电流，则三极管导通接地，相当于IO口直接接地，输出低电平。</p>
<p>将上拉电阻移动到单片机外部，此时单片机会将IO端口设计成<strong>开漏输出或开集电极</strong>状态。所以芯片的内部已经集成了上拉电阻，则外部电路不需要添加上拉电阻。上拉电阻通常用在IO的输出口上。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221119111510232.png" alt="image-20221119111510232"></p>
<p>总结上拉电阻起到的作用：</p>
<ul>
<li>在三极管导通的时候（单片机内部控制电路输出高电平），它起到一个虚假的<strong>负载</strong>，防止因为正负极直接短路造成的线材发热或烧毁三极管，因为此时电源直接通过三极管接地。</li>
<li>在三极管不通的时候，为后面的用电器提供<strong>限流</strong>的保险服务，在实际应用中，会防止后面的用电器功率或负载过大，烧毁前面的供电部分电路。这个作用跟保险丝几乎一样。</li>
</ul>
<h5 id="1-6-4-输出模式"><a href="#1-6-4-输出模式" class="headerlink" title="1.6.4 输出模式"></a>1.6.4 输出模式</h5><h6 id="①-推挽输出"><a href="#①-推挽输出" class="headerlink" title="① 推挽输出"></a>① 推挽输出</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118231911963.png" alt="image-20221118231911963"></p>
<p>上面的三极管是NPN型三极管，下面的三极管是PNP型三极管，请留意控制端、输入端和输出端。</p>
<p>当Vin电压为V+时，上面的N型三极管控制端有电流输入，Q3导通，于是电流从上往下通过，提供电流给负载。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118232011071.png" alt="image-20221118232011071"></p>
<p>经过上面的N型三极管提供电流给负载（Rload），这就叫「<strong>推</strong>」，此时的电流就是拉电流。</p>
<p>当Vin电压为V-时，下面的三极管有电流流出，Q4导通，有电流从上往下流过。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118232047658.png" alt="image-20221118232047658"></p>
<p>经过下面的P型三极管提供电流给负载（Rload），这就叫「<strong>挽</strong>」，此时的电流为灌电流。</p>
<h6 id="②-开漏输出"><a href="#②-开漏输出" class="headerlink" title="② 开漏输出"></a>② 开漏输出</h6><p>首先介绍开集输出：开集的意思，就是集电极C一端什么都不接，直接作为输出端口。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118232236171.png" alt="image-20221118232236171"></p>
<p>如果要用这种电路带一个负载，比如一个LED，<strong>必须接一个上拉电阻</strong>：当Vin没有电流，Q5断开时，LED亮。当Vin流入电流，Q5导通时，LED灭。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118232259208.png" alt="image-20221118232259208"></p>
<p>开漏电路，就是把上图中的三极管换成场效应管（MOSFET）。</p>
<h5 id="1-6-5-IO口结构"><a href="#1-6-5-IO口结构" class="headerlink" title="1.6.5 IO口结构"></a>1.6.5 IO口结构</h5><p>STC89C51RC/RD系列单片机所有I/O口均有3种工作类型∶</p>
<ul>
<li>准双向口/弱上拉（标准8051输出模式）</li>
<li>仅为输入（高阻）</li>
<li>开漏输出功能。</li>
</ul>
<p>STC89C51RC/RD+系列单片机的<strong>P1/P2/P3上电复位后为准双向口/弱上拉模式</strong>，<strong>P0口上电复位后是开漏输出</strong>。P0口作为总线扩展用时，不用加上拉电阻，作为I/O口用时，需加10K-4.7K上拉电阻。</p>
<h6 id="①-准双向P1口"><a href="#①-准双向P1口" class="headerlink" title="① 准双向P1口"></a>① 准双向P1口</h6><p>准双向P1口：8个相同结构电路，组成P1特殊功能寄存器（<code>90H</code>）</p>
<p><code>P1_n</code> = 1个锁存器（D触发器） + 1个场效应管驱动器（N沟道mos管） + 2个三态门缓冲器</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118233342247.png" alt="image-20221118233342247"></p>
<ul>
<li>单片机执行向P1口<strong>写数据指令</strong>时，P1口工作于<strong>输出方式</strong>，例如<code>P1 = 0x12</code>。如下图，内部总线写入1，经过锁存器的<code>Q非</code>口出来为0，此时mos管截止，电源vcc经过R上拉电阻向P1口出，为高电平，注意读锁存器为0，使三态门2不放行。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118235500246.png" alt="image-20221118235500246"></p>
<ul>
<li>当单片机执行从P1口读取数据并存到变量val指令时，P1口工作于<strong>读引脚方式</strong>，例如<code>val = P1</code>。但是mos管如果处于导通的情况下，会出现P1口读取不准确，可能走mosV接地那部分电路，因此要在读引脚前先执行一条<strong>写1指令强迫V截止</strong>，引脚P1电平便不会读错，所以P1口作为输入口是有条件的，要先让MOS管截止。而作为输出口是无条件的，因此，P1口被称为准双向口。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118234911073.png" alt="image-20221118234911073"></p>
<ul>
<li>当单片机执行<code>读-改-写</code>类指令时，P1口工作于<strong>读锁存器方式</strong>。如<code>P1++;</code>。Q端电平经过三态门2读入内部总线（得到P1的原始值），然后在运算器中进行+1运算，然后结果重新写到Q端(下一个上升沿，同时也输出到P1.n)。</li>
<li>读锁存器与读引脚的效果是不同的，读锁存器是为了获得前次的锁存值，而读引脚则是为了获得引脚上的当前值。</li>
</ul>
<h6 id="②-复用口P3口"><a href="#②-复用口P3口" class="headerlink" title="② 复用口P3口"></a>② 复用口P3口</h6><p>P3口：8个相同结构电路，组成P3特殊功能寄存器（<code>B0H</code>）</p>
<p><code>P3.n</code> = 1个锁存器 + 1个mos + 2个三态门 + 1个与非门</p>
<p>P3口比P1口多了一个与非门，且与非门接在Q输出端上。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221118235844906.png" alt="image-20221118235844906"></p>
<ul>
<li><strong>通用IO口</strong>：当第二输出功能端置为1时，那么与非门相当于非门，即Q变为Q非，然后接在mos管上，此时P3功能与P1功能相同，作为<strong>通用IO口</strong>；</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221119000231733.png" alt="image-20221119000231733"></p>
<ul>
<li><strong>第二输出功能</strong>：当锁存器置为1时，那么与非门相当于非门，此时通过第二输出功能来输出。例如下图，第二输出功能为1，则输出为1；</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221119000746072.png" alt="image-20221119000746072"></p>
<ul>
<li>第二输入功能：当锁存器置为1，第二输出功能置为1，那么与非门输出0，P3引脚输入则走第二输入功能引脚。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221119001046618.png" alt="image-20221119001046618"></p>
<h6 id="③-高八位拓展地址总线P2口"><a href="#③-高八位拓展地址总线P2口" class="headerlink" title="③ 高八位拓展地址总线P2口"></a>③ 高八位拓展地址总线P2口</h6><p>P2口：8个相同结构电路，组成P2特殊功能寄存器（<code>A0H</code>）</p>
<p>P2 = 1个锁存器 + 2个三态门 + 1个mos + 两路开关 + 非门</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221119001248983.png" alt="image-20221119001248983"></p>
<ul>
<li><p><strong>通用IO</strong>：系统将控制器置为0，两路开关打到锁存器端，Q经过非门为Q非，此时与P1口相同。</p>
</li>
<li><p>控制端置为1，用作外部地址总线（16位地址总线的高8位）</p>
</li>
</ul>
<h6 id="④-低八位拓展地址总线P0口"><a href="#④-低八位拓展地址总线P0口" class="headerlink" title="④ 低八位拓展地址总线P0口"></a>④ 低八位拓展地址总线P0口</h6><p>P0 = 1个锁存器 + 2个三态门 + 2个mos + 两路开关 + 与门 + 非门</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221119001614464.png" alt="image-20221119001614464"></p>
<ul>
<li>通用IO：系统会将控制端置0，两路开关打到锁存器端，而V2连接的与门一端由控制端输入 (0与任何数都等于0)，所以一直高阻态，因此当作输出时需要<strong>自行接上拉电阻</strong>。数据输入时，CPU自动使地址/数据端一1，控制端一0，故分时复用方式为<strong>无条件的真双向口</strong></li>
</ul>
<blockquote>
<p>总结</p>
</blockquote>
<p>P0-P3 口都可作为准双向通用IO口，其中只有 P0 口需要<strong>外接上拉电阻</strong>；在需要扩展片外设备时，P2 口可作为其地址线接口，P0 口可作为其地址线/数据线复用接口，此时它是真正的双向口。</p>
<h4 id="1-7-时钟电路"><a href="#1-7-时钟电路" class="headerlink" title="1.7 时钟电路"></a>1.7 时钟电路</h4><p>单片机需要时钟信号才能正常运行，时钟信号是脉冲信号的一种，周期固定，占宽比1:1的矩形脉冲波。时钟电路就是通过其他元器件综合来形成时钟信号（单片机的心跳）来提供给单片机，那么据上述可知，提供给单片机时钟信号即可让单片机运行起来。</p>
<p>下面是两种实现方式：</p>
<ul>
<li>晶振时钟：通过外部晶振电路来获取时钟信号，电容用于起振</li>
<li>脉冲时钟：外部从XTAL2引脚输入时钟信号</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120134209509.png" alt="image-20221120134209509"></p>
<h4 id="1-8-复位"><a href="#1-8-复位" class="headerlink" title="1.8 复位"></a>1.8 复位</h4><p>在微机系统中，为了保证电路的稳定可靠运行，复位电路是必不可少的一部分，复位电路的首要功能是<strong>通电复位</strong>。使单片机恢复原始默认状态的操作，通俗来讲，复位就是把你写的程序从第一步开始运行，类似一键重播功能。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kisugitakumi.oss-cn-chengdu.aliyuncs.com/img20/image-20221120134621675.png" alt="image-20221120134621675"></p>
<p>P0~P3复位默认是<code>FFH</code>，也就是默认<strong>全高电平</strong>。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://kisugitakumi.com">Kisugi Takumi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://kisugitakumi.com">https://kisugitakumi.com</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">此文章版权归Kisugi Takumi所有，如有转载，请註明来自原作者</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/51%E5%8D%95%E7%89%87%E6%9C%BA/">51单片机</a></div><div class="post_share"><div class="social-share" data-image="/img/51danpianji.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/20/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src="/img/linux.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux系统编程学习笔记</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/05/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="next-cover" src="/img/C.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C语言学习笔记</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#51%E5%8D%95%E7%89%87%E6%9C%BA%E5%9F%BA%E7%A1%80"><span class="toc-text">51单片机基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="toc-text">1 开发工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%8D%95%E7%89%87%E6%9C%BA%E5%92%8C%E5%BC%80%E5%8F%91%E6%9D%BF%E4%BB%8B%E7%BB%8D"><span class="toc-text">2 单片机和开发板介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%8D%95%E7%89%87%E6%9C%BA"><span class="toc-text">2.1 单片机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-51%E5%8D%95%E7%89%87%E6%9C%BA"><span class="toc-text">2.2 51单片机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%BC%80%E5%8F%91%E6%9D%BF"><span class="toc-text">2.3 开发板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-LED"><span class="toc-text">3 LED</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E7%82%B9%E4%BA%AE%E4%B8%80%E4%B8%AALED"><span class="toc-text">3.1 点亮一个LED</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-text">3.1.1 新建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-LED%E4%BB%8B%E7%BB%8D"><span class="toc-text">3.1.2 LED介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">3.1.3 代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-%E7%83%A7%E5%BD%95"><span class="toc-text">3.1.4 烧录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-LED%E9%97%AA%E7%83%81"><span class="toc-text">3.2 LED闪烁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-LED%E6%B5%81%E6%B0%B4%E7%81%AF"><span class="toc-text">3.3 LED流水灯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%8B%AC%E7%AB%8B%E6%8C%89%E9%94%AE"><span class="toc-text">4 独立按键</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E4%BB%8B%E7%BB%8D"><span class="toc-text">4.1 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%8E%A7%E5%88%B6LED%E4%BA%AE%E7%81%AD"><span class="toc-text">4.2 控制LED亮灭</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E6%8E%A7%E5%88%B6LED%E7%8A%B6%E6%80%81"><span class="toc-text">4.3 控制LED状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E6%8E%A7%E5%88%B6LED%E6%98%BE%E7%A4%BA%E4%BA%8C%E8%BF%9B%E5%88%B6"><span class="toc-text">4.4 控制LED显示二进制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E6%8E%A7%E5%88%B6LED%E7%A7%BB%E4%BD%8D"><span class="toc-text">4.5 控制LED移位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%95%B0%E7%A0%81%E7%AE%A1"><span class="toc-text">5 数码管</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E9%9D%99%E6%80%81%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA"><span class="toc-text">5.1 静态数码管显示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E6%A6%82%E8%BF%B0"><span class="toc-text">5.1.1 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E7%94%B5%E8%B7%AF%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-text">5.1.2 电路原理图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">5.1.3 代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%8A%A8%E6%80%81%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA"><span class="toc-text">5.2 动态数码管显示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A8%8B%E5%92%8CLCD"><span class="toc-text">6 模块化编程和LCD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">6.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E9%A2%84%E7%BC%96%E8%AF%91"><span class="toc-text">6.2 预编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E6%A8%A1%E5%9D%97%E5%8C%96%E5%AE%9E%E7%8E%B0"><span class="toc-text">6.3 模块化实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-LCD1602%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="toc-text">6.4 LCD1602调试工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-1-%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-text">6.4.1 原理图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-2-%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-text">6.4.2 代码示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98"><span class="toc-text">7 矩阵键盘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">7.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-text">7.2 原理图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98"><span class="toc-text">7.3 矩阵键盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E5%AF%86%E7%A0%81%E9%94%81"><span class="toc-text">7.4 密码锁</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-text">8 定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">8.1 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-1-%E5%AE%9A%E6%97%B6%E5%99%A8%E8%B5%84%E6%BA%90"><span class="toc-text">8.1.1 定时器资源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-%E6%A1%86%E5%9B%BE"><span class="toc-text">8.1.2 框图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-3-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-text">8.1.3 工作模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-4-%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F"><span class="toc-text">8.1.4 中断系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-5-%E7%9B%B8%E5%85%B3%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">8.1.5 相关寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0-TCON%E6%8E%A7%E5%88%B6"><span class="toc-text">① TCON控制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1-TMOD%E6%A8%A1%E5%BC%8F"><span class="toc-text">② TMOD模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A2-IE%E4%B8%AD%E6%96%AD%E5%85%81%E8%AE%B8"><span class="toc-text">③ IE中断允许</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-LED%E9%97%B4%E9%9A%94%E9%97%AA%E7%83%81"><span class="toc-text">8.2  LED间隔闪烁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E6%8C%89%E9%94%AE%E6%8E%A7%E5%88%B6LED%E6%B5%81%E6%B0%B4%E7%81%AF"><span class="toc-text">8.3 按键控制LED流水灯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E5%AE%9A%E6%97%B6%E5%99%A8%E6%97%B6%E9%92%9F"><span class="toc-text">8.4 定时器时钟</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1"><span class="toc-text">9 串口通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">9.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84UART"><span class="toc-text">9.2 单片机的UART</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-1-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-text">9.2.1 工作模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-2-%E4%B8%B2%E5%8F%A3%E5%8F%82%E6%95%B0"><span class="toc-text">9.2.2 串口参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-3-%E4%B8%B2%E5%8F%A3%E6%A8%A1%E5%BC%8F%E5%9B%BE"><span class="toc-text">9.2.3 串口模式图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-4-%E4%B8%B2%E5%8F%A3%E5%92%8C%E4%B8%AD%E6%96%AD"><span class="toc-text">9.2.4 串口和中断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-5-%E7%9B%B8%E5%85%B3%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">9.2.5 相关寄存器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E4%B8%B2%E5%8F%A3%E5%90%91%E7%94%B5%E8%84%91%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE"><span class="toc-text">9.3 串口向电脑发送数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E7%94%B5%E8%84%91%E5%90%91%E4%B8%B2%E5%8F%A3%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE"><span class="toc-text">9.4 电脑向串口发送数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-%E6%B3%A2%E7%89%B9%E7%8E%87%E8%AE%A1%E7%AE%97"><span class="toc-text">9.5 波特率计算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-LED%E7%82%B9%E9%98%B5%E5%B1%8F"><span class="toc-text">10 LED点阵屏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">10.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E7%82%B9%E9%98%B5%E6%98%BE%E7%A4%BA%E5%9B%BE%E5%BD%A2"><span class="toc-text">10.2 点阵显示图形</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%AE%9E%E6%97%B6%E6%97%B6%E9%92%9F"><span class="toc-text">11 实时时钟</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">11.1 简介</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E8%9C%82%E9%B8%A3%E5%99%A8"><span class="toc-text">12 蜂鸣器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">12.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-%E9%A9%B1%E5%8A%A8%E7%94%B5%E8%B7%AF"><span class="toc-text">12.2 驱动电路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-%E9%9F%B3%E7%AC%A6%E5%92%8C%E9%A2%91%E7%8E%87"><span class="toc-text">12.3 音符和频率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-4-%E8%9C%82%E9%B8%A3%E5%99%A8%E6%92%AD%E6%94%BE%E6%8F%90%E7%A4%BA%E9%9F%B3"><span class="toc-text">12.4 蜂鸣器播放提示音</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-5-%E8%9C%82%E9%B8%A3%E5%99%A8%E6%92%AD%E6%94%BE%E9%9F%B3%E4%B9%90"><span class="toc-text">12.5 蜂鸣器播放音乐</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-AT24C02-I2C"><span class="toc-text">13 AT24C02(I2C)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86"><span class="toc-text">补充知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%95%E7%89%87%E6%9C%BA%E5%8E%9F%E7%90%86%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89"><span class="toc-text">1 单片机原理（基础）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E4%B8%89%E5%A4%A7%E5%8F%91%E5%B1%95%E9%98%B6%E6%AE%B5"><span class="toc-text">1.1 单片机的三大发展阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6%E7%BB%93%E6%9E%84"><span class="toc-text">1.2 基础框架结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-CPU"><span class="toc-text">1.3 CPU</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-1-%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">1.3.1 控制器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-2-%E8%BF%90%E7%AE%97%E5%99%A8"><span class="toc-text">1.3.2 运算器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%AD%98%E5%82%A8"><span class="toc-text">1.4 存储</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-1-%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4"><span class="toc-text">1.4.1 存储空间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-2-%E7%A8%8B%E5%BA%8F%E5%AD%98%E5%82%A8%E5%99%A8ROM"><span class="toc-text">1.4.2 程序存储器ROM</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-3-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%99%A8RAM"><span class="toc-text">1.4.3 数据存储器RAM</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E5%8D%95%E7%89%87%E6%9C%BA%E5%BC%95%E8%84%9A"><span class="toc-text">1.5 单片机引脚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-IO%E5%8F%A3"><span class="toc-text">1.6 IO口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-6-1-%E5%9F%BA%E6%9C%AC%E5%85%83%E5%99%A8%E4%BB%B6"><span class="toc-text">1.6.1 基本元器件</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A0-%E4%BA%8C%E6%9E%81%E7%AE%A1"><span class="toc-text">① 二极管</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A1-%E4%B8%89%E6%9E%81%E7%AE%A1"><span class="toc-text">② 三极管</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A2-mos%E7%AE%A1"><span class="toc-text">③ mos管</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A3-%E4%B8%89%E6%80%81%E9%97%A8"><span class="toc-text">④ 三态门</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A4-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-text">⑤ 触发器</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-6-2-%E6%8B%89%E7%94%B5%E6%B5%81%E5%92%8C%E7%81%8C%E7%94%B5%E6%B5%81"><span class="toc-text">1.6.2 拉电流和灌电流</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-6-3-%E4%B8%8A%E6%8B%89%E5%92%8C%E4%B8%8B%E6%8B%89"><span class="toc-text">1.6.3 上拉和下拉</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-6-4-%E8%BE%93%E5%87%BA%E6%A8%A1%E5%BC%8F"><span class="toc-text">1.6.4 输出模式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A0-%E6%8E%A8%E6%8C%BD%E8%BE%93%E5%87%BA"><span class="toc-text">① 推挽输出</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A1-%E5%BC%80%E6%BC%8F%E8%BE%93%E5%87%BA"><span class="toc-text">② 开漏输出</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-6-5-IO%E5%8F%A3%E7%BB%93%E6%9E%84"><span class="toc-text">1.6.5 IO口结构</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A0-%E5%87%86%E5%8F%8C%E5%90%91P1%E5%8F%A3"><span class="toc-text">① 准双向P1口</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A1-%E5%A4%8D%E7%94%A8%E5%8F%A3P3%E5%8F%A3"><span class="toc-text">② 复用口P3口</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A2-%E9%AB%98%E5%85%AB%E4%BD%8D%E6%8B%93%E5%B1%95%E5%9C%B0%E5%9D%80%E6%80%BB%E7%BA%BFP2%E5%8F%A3"><span class="toc-text">③ 高八位拓展地址总线P2口</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E2%91%A3-%E4%BD%8E%E5%85%AB%E4%BD%8D%E6%8B%93%E5%B1%95%E5%9C%B0%E5%9D%80%E6%80%BB%E7%BA%BFP0%E5%8F%A3"><span class="toc-text">④ 低八位拓展地址总线P0口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7-%E6%97%B6%E9%92%9F%E7%94%B5%E8%B7%AF"><span class="toc-text">1.7 时钟电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-8-%E5%A4%8D%E4%BD%8D"><span class="toc-text">1.8 复位</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By Kisugi Takumi</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎来到我的个人博客!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>